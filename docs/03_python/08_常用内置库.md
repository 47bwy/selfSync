# 

### ğŸ argparse æ¨¡å—

### ğŸ binascii æ¨¡å—

#### ğŸ¯ ç¼–ç å’Œè§£ç åå…­è¿›åˆ¶æ•°
å°†ä¸€ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ä¸²è§£ç æˆä¸€ä¸ªå­—èŠ‚å­—ç¬¦ä¸²æˆ–è€…å°†ä¸€ä¸ªå­—èŠ‚å­—ç¬¦ä¸²ç¼–ç æˆä¸€ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ä¸²ã€‚å¯ä»¥ä½¿ç”¨ã€€`binascii` æ¨¡å—ã€‚ä¾‹å¦‚ï¼š
```python
>>> # Initial byte string
>>> s = b'hello'
>>> # Encode as hex
>>> import binascii
>>> h = binascii.b2a_hex(s)
>>> h
b'68656c6c6f'
>>> # Decode back to bytes
>>> binascii.a2b_hex(h)
b'hello'
>>>
```
ç±»ä¼¼çš„åŠŸèƒ½åŒæ ·å¯ä»¥åœ¨ base64 æ¨¡å—ä¸­æ‰¾åˆ°ã€‚ä¾‹å¦‚ï¼š
```python
>>> import base64
>>> h = base64.b16encode(s)
>>> h
b'68656C6C6F'
>>> base64.b16decode(h)
b'hello'
>>>
```
å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œé€šè¿‡ä½¿ç”¨ä¸Šè¿°çš„å‡½æ•°æ¥è½¬æ¢åå…­è¿›åˆ¶æ˜¯å¾ˆç®€å•çš„ã€‚ ä¸Šé¢ä¸¤ç§æŠ€æœ¯çš„ä¸»è¦ä¸åŒåœ¨äºå¤§å°å†™çš„å¤„ç†ã€‚ å‡½æ•° `base64.b16decode()` å’Œ `base64.b16encode()` åªèƒ½æ“ä½œå¤§å†™å½¢å¼çš„åå…­è¿›åˆ¶å­—æ¯ï¼Œ è€Œ `binascii` æ¨¡å—ä¸­çš„å‡½æ•°å¤§å°å†™éƒ½èƒ½å¤„ç†ã€‚


### ğŸ base64 æ¨¡å—

#### ğŸ¯ ç¼–ç è§£ç Base64æ•°æ®

ä½¿ç”¨Base64æ ¼å¼è§£ç æˆ–ç¼–ç äºŒè¿›åˆ¶æ•°æ®ã€‚`base64` æ¨¡å—ä¸­æœ‰ä¸¤ä¸ªå‡½æ•° `b64encode()` and `b64decode()` å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä¾‹å¦‚
```python
>>> # Some byte data
>>> s = b'hello'
>>> import base64

>>> # Encode as Base64
>>> a = base64.b64encode(s)
>>> a
b'aGVsbG8='

>>> # Decode from Base64
>>> base64.b64decode(a)
b'hello'
>>>
```
Base64ç¼–ç ä»…ä»…ç”¨äºé¢å‘å­—èŠ‚çš„æ•°æ®æ¯”å¦‚å­—èŠ‚å­—ç¬¦ä¸²å’Œå­—èŠ‚æ•°ç»„ã€‚ æ­¤å¤–ï¼Œç¼–ç å¤„ç†çš„è¾“å‡ºç»“æœæ€»æ˜¯ä¸€ä¸ªå­—èŠ‚å­—ç¬¦ä¸²ã€‚ å¦‚æœæƒ³æ··åˆä½¿ç”¨Base64ç¼–ç çš„æ•°æ®å’ŒUnicodeæ–‡æœ¬ï¼Œå¿…é¡»æ·»åŠ ä¸€ä¸ªé¢å¤–çš„è§£ç æ­¥éª¤ã€‚ä¾‹å¦‚ï¼š
```python
>>> a = base64.b64encode(s).decode('ascii')
>>> a
'aGVsbG8='
>>>
```
å½“è§£ç Base64çš„æ—¶å€™ï¼Œå­—èŠ‚å­—ç¬¦ä¸²å’ŒUnicodeæ–‡æœ¬éƒ½å¯ä»¥ä½œä¸ºå‚æ•°ã€‚ ä½†æ˜¯ï¼ŒUnicodeå­—ç¬¦ä¸²åªèƒ½åŒ…å«ASCIIå­—ç¬¦ã€‚


### ğŸ bisect æ¨¡å—

### ğŸ contextlib æ¨¡å—

#### ğŸ¯ contextmanager

å®ç°ä¸€ä¸ªæ–°çš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨çš„æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨ `contexlib` æ¨¡å—ä¸­çš„ `@contextmanager` è£…é¥°å™¨ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªå®ç°äº†ä»£ç å—è®¡æ—¶åŠŸèƒ½çš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨ä¾‹å­ï¼š
```python
import time
from contextlib import contextmanager

@contextmanager
def timethis(label):
    start = time.time()
    try:
        yield
    finally:
        end = time.time()
        print('{}: {}'.format(label, end - start))

# Example use
with timethis('counting'):
    n = 10000000
    while n > 0:
        n -= 1
```

åœ¨å‡½æ•° `timethis()` ä¸­ï¼Œ`yield` ä¹‹å‰çš„ä»£ç ä¼šåœ¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨ä¸­ä½œä¸º `__enter__()` æ–¹æ³•æ‰§è¡Œï¼Œ æ‰€æœ‰åœ¨ `yield` ä¹‹åçš„ä»£ç ä¼šä½œä¸º `__exit__()` æ–¹æ³•æ‰§è¡Œã€‚ å¦‚æœå‡ºç°äº†å¼‚å¸¸ï¼Œå¼‚å¸¸ä¼šåœ¨ `yield` è¯­å¥é‚£é‡ŒæŠ›å‡ºã€‚



### ğŸ collections æ¨¡å—

collections å®šä¹‰äº†å¾ˆå¤šæŠ½è±¡åŸºç±»ï¼Œå½“æƒ³è‡ªå®šä¹‰å®¹å™¨ç±»çš„æ—¶å€™å®ƒä»¬ä¼šéå¸¸æœ‰ç”¨ã€‚

#### ğŸ¯ deque()
åœ¨è¿­ä»£æ“ä½œæˆ–è€…å…¶ä»–æ“ä½œçš„æ—¶å€™ï¼Œåªä¿ç•™æœ€åæœ‰é™å‡ ä¸ªå…ƒç´ çš„å†å²è®°å½•ã€‚`deque(maxlen=N)`æ„é€ å‡½æ•°ä¼šæ–°å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„é˜Ÿåˆ—ã€‚å½“æ–°çš„å…ƒç´ åŠ å…¥å¹¶ä¸”è¿™ä¸ªé˜Ÿåˆ—å·²æ»¡çš„æ—¶å€™ï¼Œ æœ€è€çš„å…ƒç´ ä¼šè‡ªåŠ¨è¢«ç§»é™¤æ‰ã€‚

åœ¨é˜Ÿåˆ—ä¸¤ç«¯æ’å…¥æˆ–åˆ é™¤å…ƒç´ æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯`O(1)`ï¼ŒåŒºåˆ«äºåˆ—è¡¨ï¼Œåœ¨åˆ—è¡¨çš„å¼€å¤´æ’å…¥æˆ–åˆ é™¤å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦ä¸º`O(N)`ã€‚

åœ¨å†™æŸ¥è¯¢å…ƒç´ çš„ä»£ç æ—¶ï¼Œé€šå¸¸ä¼šä½¿ç”¨åŒ…å«`yield`è¡¨è¾¾å¼çš„ç”Ÿæˆå™¨å‡½æ•°ï¼Œè¿™æ ·å¯ä»¥å°†æœç´¢è¿‡ç¨‹ä»£ç å’Œä½¿ç”¨æœç´¢ç»“æœä»£ç è§£è€¦ã€‚
```python
from collections import deque


def my_search(lines, pattern, history=5):
    previous_lines = deque(maxlen=history)
    for line in lines:
        if pattern in line:
            yield line, previous_lines
        previous_lines.append(line)

# Example use on a file
if __name__ == '__main__':
    with open(r'../../cookbook/somefile.txt') as f:
        for line, prevlines in my_search(f, 'python', 5):
            for pline in prevlines:
                print(pline, end='')
            print(line, end='')
            print('-' * 20)
```

#### ğŸ¯ defaultdict()
ä¸€ä¸ªå­—å…¸å°±æ˜¯ä¸€ä¸ªé”®å¯¹åº”ä¸€ä¸ªå•å€¼çš„æ˜ å°„ã€‚å¦‚æœæƒ³è¦ä¸€ä¸ªé”®æ˜ å°„å¤šä¸ªå€¼ï¼Œå°±éœ€è¦å°†è¿™å¤šä¸ªå€¼æ”¾åˆ°å¦å¤–çš„å®¹å™¨ä¸­ï¼Œæ¯”å¦‚åˆ—è¡¨æˆ–è€…é›†åˆé‡Œé¢ã€‚

å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä½¿ç”¨`collections`æ¨¡å—ä¸­çš„`defaultdict`æ¥æ„é€ è¿™æ ·çš„å­—å…¸ã€‚ 

```python
from collections import defaultdict

d = defaultdict(list)
d['a'].append(1)
d['a'].append(2)
d['b'].append(4)

d = defaultdict(set)
d['a'].add(1)
d['a'].add(2)
d['b'].add(4)
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ defaultdict ä¼šè‡ªåŠ¨ä¸ºå°†è¦è®¿é—®çš„é”®ï¼ˆå°±ç®—ç›®å‰å­—å…¸ä¸­å¹¶ä¸å­˜åœ¨è¿™æ ·çš„é”®ï¼‰åˆ›å»ºæ˜ å°„å®ä½“ã€‚ 


#### ğŸ¯ OrderedDict()
åˆ›å»ºä¸€ä¸ªå­—å…¸ï¼Œå¹¶ä¸”åœ¨è¿­ä»£æˆ–åºåˆ—åŒ–è¿™ä¸ªå­—å…¸çš„æ—¶å€™èƒ½å¤Ÿæ§åˆ¶å…ƒç´ çš„é¡ºåºã€‚

ä¸ºäº†èƒ½æ§åˆ¶ä¸€ä¸ªå­—å…¸ä¸­å…ƒç´ çš„é¡ºåºï¼Œå¯ä»¥ä½¿ç”¨`collections`æ¨¡å—ä¸­çš„`OrderedDict`ç±»ã€‚åœ¨è¿­ä»£æ“ä½œçš„æ—¶å€™å®ƒä¼šä¿æŒå…ƒç´ è¢«æ’å…¥æ—¶çš„é¡ºåº

```python
from collections import OrderedDict

d = OrderedDict()
d['foo'] = 1
d['bar'] = 2
d['spam'] = 3
d['grok'] = 4
# Outputs "foo 1", "bar 2", "spam 3", "grok 4"
for key in d:
    print(key, d[key])
```

`OrderedDict` å†…éƒ¨ç»´æŠ¤ç€ä¸€ä¸ªæ ¹æ®é”®æ’å…¥é¡ºåºæ’åºçš„åŒå‘é“¾è¡¨ã€‚æ¯æ¬¡å½“ä¸€ä¸ªæ–°çš„å…ƒç´ æ’å…¥è¿›æ¥çš„æ—¶å€™ï¼Œ å®ƒä¼šè¢«æ”¾åˆ°é“¾è¡¨çš„å°¾éƒ¨ã€‚å¯¹äºä¸€ä¸ªå·²ç»å­˜åœ¨çš„é”®çš„é‡å¤èµ‹å€¼ä¸ä¼šæ”¹å˜é”®çš„é¡ºåºã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€ä¸ª `OrderedDict` çš„å¤§å°æ˜¯ä¸€ä¸ªæ™®é€šå­—å…¸çš„ä¸¤å€ï¼Œå› ä¸ºå®ƒå†…éƒ¨ç»´æŠ¤ç€å¦å¤–ä¸€ä¸ªé“¾è¡¨ã€‚ æ‰€ä»¥å¦‚æœè¦æ„å»ºä¸€ä¸ªéœ€è¦å¤§é‡ `OrderedDict` å®ä¾‹çš„æ•°æ®ç»“æ„çš„æ—¶å€™ï¼ˆæ¯”å¦‚è¯»å– 100,000 è¡Œ CSV æ•°æ®åˆ°ä¸€ä¸ª `OrderedDict` åˆ—è¡¨ä¸­å»ï¼‰ï¼Œ é‚£ä¹ˆå°±å¾—ä»”ç»†æƒè¡¡ä¸€ä¸‹æ˜¯å¦ä½¿ç”¨ `OrderedDict` å¸¦æ¥çš„å¥½å¤„è¦å¤§è¿‡é¢å¤–å†…å­˜æ¶ˆè€—çš„å½±å“ã€‚


#### ğŸ¯ Counter()
æ‰¾å‡ºä¸€ä¸ªåºåˆ—ä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„å…ƒç´ 
```python
words = [
    'look', 'into', 'my', 'eyes', 'look', 'into', 'my', 'eyes',
    'the', 'eyes', 'the', 'eyes', 'the', 'eyes', 'not', 'around', 'the',
    'eyes', "don't", 'look', 'around', 'the', 'eyes', 'look', 'into',
    'my', 'eyes', "you're", 'under'
]
from collections import Counter
word_counts = Counter(words)
# å‡ºç°é¢‘ç‡æœ€é«˜çš„3ä¸ªå•è¯
top_three = word_counts.most_common(3)
print(top_three)
# Outputs [('eyes', 8), ('the', 5), ('look', 4)]
```

#### ğŸ¯ namedtuple()
`collections.namedtuple()`è¿™ä¸ªå‡½æ•°å®é™…ä¸Šæ˜¯ä¸€ä¸ªè¿”å› Python ä¸­æ ‡å‡†å…ƒç»„ç±»å‹å­ç±»çš„ä¸€ä¸ªå·¥å‚æ–¹æ³•ã€‚

ä¼ é€’ä¸€ä¸ªç±»å‹åå’Œéœ€è¦çš„å­—æ®µç»™å®ƒï¼Œç„¶åå®ƒå°±ä¼šè¿”å›ä¸€ä¸ªç±»ï¼Œå¯ä»¥åˆå§‹åŒ–è¿™ä¸ªç±»ï¼Œä¸ºå®šä¹‰çš„å­—æ®µä¼ é€’å€¼ç­‰ã€‚
```python
>>> from collections import namedtuple
>>> Subscriber = namedtuple('Subscriber', ['addr', 'joined'])
>>> sub = Subscriber('jonesy@example.com', '2012-10-19')
>>> sub
Subscriber(addr='jonesy@example.com', joined='2012-10-19')
>>> sub.addr
'jonesy@example.com'
>>> sub.joined
'2012-10-19'
>>>
```
å°½ç®¡ `namedtuple` çš„å®ä¾‹çœ‹èµ·æ¥åƒä¸€ä¸ªæ™®é€šçš„ç±»å®ä¾‹ï¼Œä½†æ˜¯å®ƒè·Ÿå…ƒç»„ç±»å‹æ˜¯å¯äº¤æ¢çš„ï¼Œæ”¯æŒæ‰€æœ‰çš„æ™®é€šå…ƒç»„æ“ä½œï¼Œæ¯”å¦‚ç´¢å¼•å’Œè§£å‹ã€‚ æ¯”å¦‚ï¼š
```python
>>> len(sub)
2
>>> addr, joined = sub
>>> addr
'jonesy@example.com'
>>> joined
'2012-10-19'
>>>
```
å‘½åå…ƒç»„çš„ä¸€ä¸ªä¸»è¦ç”¨é€”æ˜¯å°†ä»£ç ä»ä¸‹æ ‡æ“ä½œä¸­è§£è„±å‡ºæ¥ã€‚ å› æ­¤ï¼Œåœ¨æ•°æ®åº“è°ƒç”¨ä¸­è¿”å›äº†ä¸€ä¸ªå¾ˆå¤§çš„å…ƒç»„åˆ—è¡¨çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨å‘½åå…ƒç»„å¢åˆ å°±ä¼šå¾ˆæ–¹ä¾¿ã€‚
```python
def compute_cost(records):
    total = 0.0
    for rec in records:
        total += rec[1] * rec[2]
    return total
```
ä¸‹æ ‡æ“ä½œé€šå¸¸ä¼šè®©ä»£ç è¡¨æ„ä¸æ¸…æ™°ï¼Œå¹¶ä¸”éå¸¸ä¾èµ–è®°å½•çš„ç»“æ„ã€‚ ä¸‹é¢æ˜¯ä½¿ç”¨å‘½åå…ƒç»„çš„ç‰ˆæœ¬ï¼š
```python
from collections import namedtuple

Stock = namedtuple('Stock', ['name', 'shares', 'price'])
def compute_cost(records):
    total = 0.0
    for rec in records:
        s = Stock(*rec)
        total += s.shares * s.price
    return total
```

å‘½åå…ƒç»„å¦ä¸€ä¸ªç”¨é€”å°±æ˜¯ä½œä¸ºå­—å…¸çš„æ›¿ä»£ï¼Œå› ä¸ºå­—å…¸å­˜å‚¨éœ€è¦æ›´å¤šçš„å†…å­˜ç©ºé—´ã€‚ å¦‚æœéœ€è¦æ„å»ºä¸€ä¸ªéå¸¸å¤§çš„åŒ…å«å­—å…¸çš„æ•°æ®ç»“æ„ï¼Œé‚£ä¹ˆä½¿ç”¨å‘½åå…ƒç»„ä¼šæ›´åŠ é«˜æ•ˆã€‚ ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸åƒå­—å…¸é‚£æ ·ï¼Œä¸€ä¸ªå‘½åå…ƒç»„æ˜¯ä¸å¯æ›´æ”¹çš„ã€‚æ¯”å¦‚ï¼š
```python
>>> s = Stock('ACME', 100, 123.45)
>>> s
Stock(name='ACME', shares=100, price=123.45)
>>> s.shares = 75
Traceback (most recent call last):
File "<stdin>", line 1, in <module>
AttributeError: can't set attribute
>>>
```
å¦‚æœçœŸçš„éœ€è¦æ”¹å˜å±æ€§çš„å€¼ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨å‘½åå…ƒç»„å®ä¾‹çš„ `_replace()` æ–¹æ³•ï¼Œ å®ƒä¼šåˆ›å»ºä¸€ä¸ªå…¨æ–°çš„å‘½åå…ƒç»„å¹¶å°†å¯¹åº”çš„å­—æ®µç”¨æ–°çš„å€¼å–ä»£ã€‚æ¯”å¦‚ï¼š
```python
>>> s = s._replace(shares=75)
>>> s
Stock(name='ACME', shares=75, price=123.45)
>>>
```

#### ğŸ¯ ChainMap()
ç°åœ¨æœ‰å¤šä¸ªå­—å…¸æˆ–è€…æ˜ å°„ï¼Œå°†å®ƒä»¬ä»é€»è¾‘ä¸Šåˆå¹¶ä¸ºä¸€ä¸ªå•ä¸€çš„æ˜ å°„åæ‰§è¡ŒæŸäº›æ“ä½œï¼Œæ¯”å¦‚æŸ¥æ‰¾å€¼æˆ–è€…æ£€æŸ¥æŸäº›é”®æ˜¯å¦å­˜åœ¨ã€‚
```python
a = {'x': 1, 'z': 3 }
b = {'y': 2, 'z': 4 }
from collections import ChainMap
c = ChainMap(a,b)
print(c['x']) # Outputs 1 (from a)
print(c['y']) # Outputs 2 (from b)
print(c['z']) # Outputs 3 (from a)
```
ä¸€ä¸ª `ChainMap` æ¥å—å¤šä¸ªå­—å…¸å¹¶å°†å®ƒä»¬åœ¨é€»è¾‘ä¸Šå˜ä¸ºä¸€ä¸ªå­—å…¸ã€‚ ç„¶åï¼Œè¿™äº›å­—å…¸å¹¶ä¸æ˜¯çœŸçš„åˆå¹¶åœ¨ä¸€èµ·äº†ï¼Œ `ChainMap` ç±»åªæ˜¯åœ¨å†…éƒ¨åˆ›å»ºäº†ä¸€ä¸ªå®¹çº³è¿™äº›å­—å…¸çš„åˆ—è¡¨ å¹¶é‡æ–°å®šä¹‰äº†ä¸€äº›å¸¸è§çš„å­—å…¸æ“ä½œæ¥éå†è¿™ä¸ªåˆ—è¡¨ã€‚å¤§éƒ¨åˆ†å­—å…¸æ“ä½œéƒ½æ˜¯å¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚

ä¸ `update()` ä¸åŒçš„æ˜¯ï¼šä½¿ç”¨ `update` å¦‚æœåŸå­—å…¸åšäº†æ›´æ–°ï¼Œè¿™ç§æ”¹å˜ä¸ä¼šååº”åˆ°æ–°çš„åˆå¹¶å­—å…¸ä¸­å»ã€‚`ChainMap` ä½¿ç”¨åŸæ¥çš„å­—å…¸ï¼Œå®ƒè‡ªå·±ä¸åˆ›å»ºæ–°çš„å­—å…¸ï¼Œæ‰€ä»¥ä¼šéšä¹‹æ”¹å˜ã€‚


### ğŸ datetime æ¨¡å—

```python
from datetime import datetime, timedelta

# å½“å‰æ—¶é—´
now = datetime.now()
print("å½“å‰ datetime:", now, type(now))  
# 2025-04-10 15:30:45.123456 <class 'datetime.datetime'>

# è‡ªå®šä¹‰æ—¶é—´
d = datetime(2024, 12, 31, 23, 59, 59)
print("è‡ªå®šä¹‰ datetime:", d, type(d))  
# 2024-12-31 23:59:59 <class 'datetime.datetime'>

# datetime -> å­—ç¬¦ä¸²
formatted = d.strftime("%Y/%m/%d %H:%M")
print("æ ¼å¼åŒ–:", formatted, type(formatted))  
# '2024/12/31 23:59' <class 'str'>

# å­—ç¬¦ä¸² -> datetime
parsed_dt = datetime.strptime("2025-03-15 08:30", "%Y-%m-%d %H:%M")
print("å­—ç¬¦ä¸²è§£æä¸º datetime:", parsed_dt, type(parsed_dt))  
# 2025-03-15 08:30:00 <class 'datetime.datetime'>

# è·å–æ—¶é—´å·®
delta = now - parsed_dt
print("æ—¶é—´å·®:", delta, type(delta))  
# datetime.timedelta(days=..., seconds=...) <class 'datetime.timedelta'>

print("å·®å¤šå°‘å¤©:", delta.days, type(delta.days))  
# 26 <class 'int'>
print("å·®å¤šå°‘ç§’:", delta.total_seconds(), type(delta.total_seconds()))  
# 2276400.0 <class 'float'>

# åŠ å‡æ—¶é—´
future = now + timedelta(days=7)
print("7å¤©å:", future, type(future))  
# <class 'datetime.datetime'>
past = now - timedelta(hours=3)
print("3å°æ—¶å‰:", past, type(past))  
# <class 'datetime.datetime'>

# datetime -> æ—¶é—´æˆ³
timestamp = now.timestamp()
print("å½“å‰ datetime è½¬æ—¶é—´æˆ³:", timestamp, type(timestamp))  
# 1681440000.0 <class 'float'>

# æ—¶é—´æˆ³ -> datetime
from_ts = datetime.fromtimestamp(timestamp)
print("æ—¶é—´æˆ³è½¬ datetime:", from_ts, type(from_ts))  
# <class 'datetime.datetime'>

# ISO æ ¼å¼æ—¶é—´ï¼ˆæ ‡å‡†æ ¼å¼ï¼‰
iso_str = now.isoformat()
print("ISO æ ¼å¼:", iso_str, type(iso_str))  
# '2025-04-10T15:30:45.123456' <class 'str'>

# è·å–å½“å‰ UTC æ—¶é—´
utc_now = datetime.utcnow()
print("å½“å‰ UTC æ—¶é—´:", utc_now, type(utc_now))  
# <class 'datetime.datetime'>

# æ›¿æ¢ datetime ä¸­çš„éƒ¨åˆ†å€¼
new_time = now.replace(hour=0, minute=0)
print("æ›¿æ¢åçš„æ—¶é—´:", new_time, type(new_time))  
# <class 'datetime.datetime'>
```

| å†…å®¹              | ç¤ºä¾‹è¾“å‡ºç±»å‹                   |
| ----------------- | ------------------------------ |
| æ—¶é—´æˆ³            | `<class 'float'>`              |
| æ—¶é—´å…ƒç»„          | `<class 'time.struct_time'>`   |
| æ ¼å¼åŒ–å­—ç¬¦ä¸²æ—¶é—´  | `<class 'str'>`                |
| `datetime` å¯¹è±¡   | `<class 'datetime.datetime'>`  |
| æ—¶é—´å·®å¯¹è±¡        | `<class 'datetime.timedelta'>` |
| `total_seconds()` | `<class 'float'>`              |
| `days` å±æ€§       | `<class 'int'>`                |




### ğŸ decimal æ¨¡å—
ç²¾ç¡®è®¡ç®—æµ®ç‚¹æ•°ï¼ˆå¹¶èƒ½å®¹å¿ä¸€å®šçš„æ€§èƒ½æŸè€—ï¼‰ã€‚

 `decimal` æ¨¡å—ä¸»è¦ç”¨åœ¨æ¶‰åŠåˆ°é‡‘èçš„é¢†åŸŸã€‚ åœ¨è¿™ç±»ç¨‹åºä¸­ï¼Œå“ªæ€•æ˜¯ä¸€ç‚¹å°å°çš„è¯¯å·®åœ¨è®¡ç®—è¿‡ç¨‹ä¸­è”“å»¶éƒ½æ˜¯ä¸å…è®¸çš„ã€‚ å› æ­¤ï¼Œ `decimal` æ¨¡å—ä¸ºè§£å†³è¿™ç±»é—®é¢˜æä¾›äº†æ–¹æ³•ã€‚ å½“Pythonå’Œæ•°æ®åº“æ‰“äº¤é“çš„æ—¶å€™ä¹Ÿé€šå¸¸ä¼šé‡åˆ° `Decimal` å¯¹è±¡ï¼Œå¹¶ä¸”ï¼Œé€šå¸¸ä¹Ÿæ˜¯åœ¨å¤„ç†é‡‘èæ•°æ®çš„æ—¶å€™ã€‚

```python
>>> from decimal import Decimal
>>> a = Decimal('4.2')
>>> b = Decimal('2.1')
>>> a + b
Decimal('6.3')
>>> print(a + b)
6.3
>>> (a + b) == Decimal('6.3')
True
```

### ğŸ fractions æ¨¡å—
`fractions` æ¨¡å—å¯ä»¥è¢«ç”¨æ¥æ‰§è¡ŒåŒ…å«åˆ†æ•°çš„æ•°å­¦è¿ç®—ã€‚æ¯”å¦‚ï¼š
```python
>>> from fractions import Fraction
>>> a = Fraction(5, 4)
>>> b = Fraction(7, 16)
>>> print(a + b)
27/16
>>> print(a * b)
35/64

>>> # Getting numerator/denominator
>>> c = a * b
>>> c.numerator
35
>>> c.denominator
64

>>> # Converting to a float
>>> float(c)
0.546875

>>> # Limiting the denominator of a value
>>> print(c.limit_denominator(8))
4/7

>>> # Converting a float to a fraction
>>> x = 3.75
>>> y = Fraction(*x.as_integer_ratio())
>>> y
Fraction(15, 4)
>>>
```


### ğŸ functools æ¨¡å—

#### ğŸ¯ partial()

`partial()` å‡½æ•°å…è®¸ç»™ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°è®¾ç½®å›ºå®šçš„å€¼ï¼Œå‡å°‘æ¥ä¸‹æ¥è¢«è°ƒç”¨æ—¶çš„å‚æ•°ä¸ªæ•°ã€‚ 

ç¬¬ä¸€ä¸ªä¾‹å­æ˜¯ï¼Œå‡è®¾æœ‰ä¸€ä¸ªç‚¹çš„åˆ—è¡¨æ¥è¡¨ç¤º(x,y)åæ ‡å…ƒç»„ã€‚ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‡½æ•°æ¥è®¡ç®—ä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»ï¼š
```python
points = [ (1, 2), (3, 4), (5, 6), (7, 8) ]

import math
def distance(p1, p2):
    x1, y1 = p1
    x2, y2 = p2
    return math.hypot(x2 - x1, y2 - y1)
```

ç°åœ¨å‡è®¾æƒ³ä»¥æŸä¸ªç‚¹ä¸ºåŸºç‚¹ï¼Œæ ¹æ®ç‚¹å’ŒåŸºç‚¹ä¹‹é—´çš„è·ç¦»æ¥æ’åºæ‰€æœ‰çš„è¿™äº›ç‚¹ã€‚ åˆ—è¡¨çš„ `sort()` æ–¹æ³•æ¥å—ä¸€ä¸ªå…³é”®å­—å‚æ•°æ¥è‡ªå®šä¹‰æ’åºé€»è¾‘ï¼Œ ä½†æ˜¯å®ƒåªèƒ½æ¥å—ä¸€ä¸ªå•ä¸ªå‚æ•°çš„å‡½æ•°ï¼ˆdistance()å¾ˆæ˜æ˜¾æ˜¯ä¸ç¬¦åˆæ¡ä»¶çš„ï¼‰ã€‚ ç°åœ¨æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ `partial()` æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š
```python
>>> pt = (4, 3)
>>> points.sort(key=partial(distance, pt))
>>> points
[(3, 4), (1, 2), (5, 6), (7, 8)]
>>>
```

å¾ˆå¤šæ—¶å€™ `partial()`èƒ½å®ç°çš„æ•ˆæœï¼Œlambda è¡¨è¾¾å¼ä¹Ÿèƒ½å®ç°ã€‚æ¯”å¦‚ï¼Œä¹‹å‰çš„å‡ ä¸ªä¾‹å­å¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™æ ·çš„è¡¨è¾¾å¼ï¼š
```python
points.sort(key=lambda p: distance(pt, p))
```

#### ğŸ¯ total_orderingï¼ˆè®©ç±»æ”¯æŒæ¯”è¾ƒæ“ä½œï¼‰

æƒ³è®©æŸä¸ªç±»çš„å®ä¾‹æ”¯æŒæ ‡å‡†çš„æ¯”è¾ƒè¿ç®—(æ¯”å¦‚>=,!=,<=,<ç­‰)ï¼Œä½†æ˜¯åˆä¸æƒ³å»å®ç°é‚£ä¸€å¤§ä¸¢çš„ç‰¹æ®Šæ–¹æ³•ã€‚

Pythonç±»å¯¹æ¯ä¸ªæ¯”è¾ƒæ“ä½œéƒ½éœ€è¦å®ç°ä¸€ä¸ªç‰¹æ®Šæ–¹æ³•æ¥æ”¯æŒã€‚ ä¾‹å¦‚ä¸ºäº†æ”¯æŒ>=æ“ä½œç¬¦ï¼Œéœ€è¦å®šä¹‰ä¸€ä¸ª `__ge__()` æ–¹æ³•ã€‚ å°½ç®¡å®šä¹‰ä¸€ä¸ªæ–¹æ³•æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†å¦‚æœè¦å®ç°æ‰€æœ‰å¯èƒ½çš„æ¯”è¾ƒæ–¹æ³•é‚£å°±æœ‰ç‚¹çƒ¦äººäº†ã€‚

è£…é¥°å™¨ functools.total_ordering å°±æ˜¯ç”¨æ¥ç®€åŒ–è¿™ä¸ªå¤„ç†çš„ã€‚ ä½¿ç”¨å®ƒæ¥è£…é¥°ä¸€ä¸ªç±»ï¼Œåªéœ€å®šä¹‰ä¸€ä¸ª `__eq__()` æ–¹æ³•ï¼Œ å¤–åŠ å…¶ä»–æ–¹æ³•(`__lt__`, `__le__`, `__gt__`, or `__ge__`)ä¸­çš„ä¸€ä¸ªå³å¯ã€‚ ç„¶åè£…é¥°å™¨ä¼šè‡ªåŠ¨ä¸ºå¡«å……å…¶å®ƒæ¯”è¾ƒæ–¹æ³•ã€‚

ä½œä¸ºä¾‹å­ï¼Œæˆ‘ä»¬æ„å»ºä¸€äº›æˆ¿å­ï¼Œç„¶åç»™å®ƒä»¬å¢åŠ ä¸€äº›æˆ¿é—´ï¼Œæœ€åé€šè¿‡æˆ¿å­å¤§å°æ¥æ¯”è¾ƒå®ƒä»¬ï¼š
```python
from functools import total_ordering

class Room:
    def __init__(self, name, length, width):
        self.name = name
        self.length = length
        self.width = width
        self.square_feet = self.length * self.width

@total_ordering
class House:
    def __init__(self, name, style):
        self.name = name
        self.style = style
        self.rooms = list()

    @property
    def living_space_footage(self):
        return sum(r.square_feet for r in self.rooms)

    def add_room(self, room):
        self.rooms.append(room)

    def __str__(self):
        return '{}: {} square foot {}'.format(self.name,
                self.living_space_footage,
                self.style)

    def __eq__(self, other):
        return self.living_space_footage == other.living_space_footage

    def __lt__(self, other):
        return self.living_space_footage < other.living_space_footage
```

è¿™é‡Œæˆ‘ä»¬åªæ˜¯ç»™Houseç±»å®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•ï¼š`__eq__()` å’Œ `__lt__()` ï¼Œå®ƒå°±èƒ½æ”¯æŒæ‰€æœ‰çš„æ¯”è¾ƒæ“ä½œï¼š
```python
# Build a few houses, and add rooms to them
h1 = House('h1', 'Cape')
h1.add_room(Room('Master Bedroom', 14, 21))
h1.add_room(Room('Living Room', 18, 20))
h1.add_room(Room('Kitchen', 12, 16))
h1.add_room(Room('Office', 12, 12))
h2 = House('h2', 'Ranch')
h2.add_room(Room('Master Bedroom', 14, 21))
h2.add_room(Room('Living Room', 18, 20))
h2.add_room(Room('Kitchen', 12, 16))
h3 = House('h3', 'Split')
h3.add_room(Room('Master Bedroom', 14, 21))
h3.add_room(Room('Living Room', 18, 20))
h3.add_room(Room('Office', 12, 16))
h3.add_room(Room('Kitchen', 15, 17))
houses = [h1, h2, h3]
print('Is h1 bigger than h2?', h1 > h2) # prints True
print('Is h2 smaller than h3?', h2 < h3) # prints True
print('Is h2 greater than or equal to h1?', h2 >= h1) # Prints False
print('Which one is biggest?', max(houses)) # Prints 'h3: 1101-square-foot Split'
print('Which is smallest?', min(houses)) # Prints 'h2: 846-square-foot Ranch'
```

å…¶å® `total_ordering` è£…é¥°å™¨ä¹Ÿæ²¡é‚£ä¹ˆç¥ç§˜ã€‚ å®ƒå°±æ˜¯å®šä¹‰äº†ä¸€ä¸ªä»æ¯ä¸ªæ¯”è¾ƒæ”¯æŒæ–¹æ³•åˆ°æ‰€æœ‰éœ€è¦å®šä¹‰çš„å…¶ä»–æ–¹æ³•çš„ä¸€ä¸ªæ˜ å°„è€Œå·²ã€‚ æ¯”å¦‚å®šä¹‰äº† `__le__()` æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒå°±è¢«ç”¨æ¥æ„å»ºæ‰€æœ‰å…¶ä»–çš„éœ€è¦å®šä¹‰çš„é‚£äº›ç‰¹æ®Šæ–¹æ³•ã€‚ å®é™…ä¸Šå°±æ˜¯åœ¨ç±»é‡Œé¢åƒä¸‹é¢è¿™æ ·å®šä¹‰äº†ä¸€äº›ç‰¹æ®Šæ–¹æ³•ï¼š
```python
class House:
    def __eq__(self, other):
        pass
    def __lt__(self, other):
        pass
    # Methods created by @total_ordering
    __le__ = lambda self, other: self < other or self == other
    __gt__ = lambda self, other: not (self < other or self == other)
    __ge__ = lambda self, other: not (self < other)
    __ne__ = lambda self, other: not self == other
```







### ğŸ heapq æ¨¡å—

#### ğŸ¯ ä»ä¸€ä¸ªé›†åˆä¸­è·å¾—æœ€å¤§æˆ–è€…æœ€å°çš„ N ä¸ªå…ƒç´ åˆ—è¡¨ã€‚

heapq æ¨¡å—æœ‰ä¸¤ä¸ªå‡½æ•°ï¼š`nlargest()`å’Œ`nsmallest()`å¯ä»¥å®Œç¾è§£å†³è¿™ä¸ªé—®é¢˜ã€‚
```python
import heapq
nums = [1, 8, 2, 23, 7, -4, 18, 23, 42, 37, 2]
print(heapq.nlargest(3, nums)) # Prints [42, 37, 23]
print(heapq.nsmallest(3, nums)) # Prints [-4, 1, 2]
```
åœ¨åº•å±‚å®ç°é‡Œé¢ï¼Œé¦–å…ˆä¼šå…ˆå°†é›†åˆæ•°æ®è¿›è¡Œå †æ’åºåæ”¾å…¥ä¸€ä¸ªåˆ—è¡¨ä¸­ã€‚

å †æ•°æ®ç»“æ„æœ€é‡è¦çš„ç‰¹å¾æ˜¯`heap[0]`æ°¸è¿œæ˜¯æœ€å°çš„å…ƒç´ ã€‚å¹¶ä¸”å‰©ä½™çš„å…ƒç´ å¯ä»¥å¾ˆå®¹æ˜“çš„é€šè¿‡è°ƒç”¨`heapq.heappop()`æ–¹æ³•å¾—åˆ°ï¼Œ è¯¥æ–¹æ³•ä¼šå…ˆå°†ç¬¬ä¸€ä¸ªå…ƒç´ å¼¹å‡ºæ¥ï¼Œç„¶åç”¨ä¸‹ä¸€ä¸ªæœ€å°çš„å…ƒç´ æ¥å–ä»£è¢«å¼¹å‡ºå…ƒç´ ï¼ˆè¿™ç§æ“ä½œæ—¶é—´å¤æ‚åº¦ä»…ä»…æ˜¯`O(log N)`ï¼Œ`N`æ˜¯å †å¤§å°ï¼‰ã€‚
```python
>>> nums = [1, 8, 2, 23, 7, -4, 18, 23, 42, 37, 2]
>>> import heapq
>>> heap = list(nums)
>>> heapq.heapify(heap)
>>> heap
[-4, 2, 1, 23, 7, 2, 18, 23, 42, 37, 8]
>>>
```

å½“è¦æŸ¥æ‰¾çš„å…ƒç´ ä¸ªæ•°ç›¸å¯¹æ¯”è¾ƒå°çš„æ—¶å€™ï¼Œå‡½æ•° `nlargest()` å’Œ `nsmallest()` æ˜¯å¾ˆåˆé€‚çš„ã€‚ å¦‚æœä»…ä»…æƒ³æŸ¥æ‰¾å”¯ä¸€çš„æœ€å°æˆ–æœ€å¤§ï¼ˆN=1ï¼‰çš„å…ƒç´ çš„è¯ï¼Œé‚£ä¹ˆä½¿ç”¨ `min()` å’Œ `max()` å‡½æ•°ä¼šæ›´å¿«äº›ã€‚ ç±»ä¼¼çš„ï¼Œå¦‚æœ N çš„å¤§å°å’Œé›†åˆå¤§å°æ¥è¿‘çš„æ—¶å€™ï¼Œé€šå¸¸å…ˆæ’åºè¿™ä¸ªé›†åˆç„¶åå†ä½¿ç”¨åˆ‡ç‰‡æ“ä½œä¼šæ›´å¿«ç‚¹ ï¼ˆ `sorted(items)[:N]` æˆ–è€…æ˜¯ `sorted(items)[-N:]` ï¼‰ã€‚ éœ€è¦åœ¨æ­£ç¡®åœºåˆä½¿ç”¨å‡½æ•° `nlargest()` å’Œ `nsmallest()` æ‰èƒ½å‘æŒ¥å®ƒä»¬çš„ä¼˜åŠ¿ ï¼ˆå¦‚æœ N å¿«æ¥è¿‘é›†åˆå¤§å°äº†ï¼Œé‚£ä¹ˆä½¿ç”¨æ’åºæ“ä½œä¼šæ›´å¥½äº›ï¼‰ã€‚

#### ğŸ¯ é¡ºåºè¿­ä»£åˆå¹¶åçš„æ’åºè¿­ä»£å¯¹è±¡
æœ‰ä¸€ç³»åˆ—æ’åºåºåˆ—ï¼Œæƒ³å°†å®ƒä»¬åˆå¹¶åå¾—åˆ°ä¸€ä¸ªæ’åºåºåˆ—å¹¶åœ¨ä¸Šé¢è¿­ä»£éå†ã€‚
```python
>>> import heapq
>>> a = [1, 4, 7, 10]
>>> b = [2, 5, 6, 11]
>>> for c in heapq.merge(a, b):
...     print(c)
...
1
2
4
5
6
7
10
11
```
`heapq.merge()` éœ€è¦æ‰€æœ‰è¾“å…¥åºåˆ—å¿…é¡»æ˜¯æ’è¿‡åºçš„ã€‚ ç‰¹åˆ«çš„ï¼Œå®ƒå¹¶ä¸ä¼šé¢„å…ˆè¯»å–æ‰€æœ‰æ•°æ®åˆ°å †æ ˆä¸­æˆ–è€…é¢„å…ˆæ’åºï¼Œä¹Ÿä¸ä¼šå¯¹è¾“å…¥åšä»»ä½•çš„æ’åºæ£€æµ‹ã€‚å®ƒä»…ä»…æ˜¯æ£€æŸ¥æ‰€æœ‰åºåˆ—çš„å¼€å§‹éƒ¨åˆ†å¹¶è¿”å›æœ€å°çš„é‚£ä¸ªï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸€ç›´ä¼šæŒç»­ç›´åˆ°æ‰€æœ‰è¾“å…¥åºåˆ—ä¸­çš„å…ƒç´ éƒ½è¢«éå†å®Œã€‚


### ğŸ hashlib æ¨¡å—

### ğŸ inspect æ¨¡å—

#### ğŸ¯ ğŸ¯ `*args`å’Œ`**kwargs`çš„å¼ºåˆ¶å‚æ•°ç­¾åã€‚

æœ‰ä¸€ä¸ªå‡½æ•°æˆ–æ–¹æ³•ï¼Œå®ƒä½¿ç”¨`*args`å’Œ`**kwargs`ä½œä¸ºå‚æ•°ï¼Œè¿™æ ·ä½¿å¾—å®ƒæ¯”è¾ƒé€šç”¨ï¼Œ ä½†æœ‰æ—¶å€™æƒ³æ£€æŸ¥ä¼ é€’è¿›æ¥çš„å‚æ•°æ˜¯ä¸æ˜¯æŸä¸ªæƒ³è¦çš„ç±»å‹ã€‚

å¯¹ä»»ä½•æ¶‰åŠåˆ°æ“ä½œå‡½æ•°è°ƒç”¨ç­¾åçš„é—®é¢˜ï¼Œéƒ½åº”è¯¥ä½¿ç”¨ inspect æ¨¡å—ä¸­çš„ç­¾åç‰¹æ€§ã€‚ æˆ‘ä»¬æœ€ä¸»è¦å…³æ³¨ä¸¤ä¸ªç±»ï¼š`Signature` å’Œ `Parameter` ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªåˆ›å»ºå‡½æ•°å‰é¢çš„äº¤äº’ä¾‹å­ï¼š
```python
>>> from inspect import Signature, Parameter
>>> # Make a signature for a func(x, y=42, *, z=None)
>>> parms = [ Parameter('x', Parameter.POSITIONAL_OR_KEYWORD),
...         Parameter('y', Parameter.POSITIONAL_OR_KEYWORD, default=42),
...         Parameter('z', Parameter.KEYWORD_ONLY, default=None) ]
>>> sig = Signature(parms)
>>> print(sig)
(x, y=42, *, z=None)
>>>
```

ä¸€æ—¦æœ‰äº†ä¸€ä¸ªç­¾åå¯¹è±¡ï¼Œå°±å¯ä»¥ä½¿ç”¨å®ƒçš„ `bind()` æ–¹æ³•å¾ˆå®¹æ˜“çš„å°†å®ƒç»‘å®šåˆ° `*args` å’Œ `**kwargs` ä¸Šå»ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„æ¼”ç¤ºï¼š
```python
>>> def func(*args, **kwargs):
...     bound_values = sig.bind(*args, **kwargs)
...     for name, value in bound_values.arguments.items():
...         print(name,value)
...
>>> # Try various examples
>>> func(1, 2, z=3)
x 1
y 2
z 3
>>> func(1)
x 1
>>> func(1, z=3)
x 1
z 3
>>> func(y=2, x=1)
x 1
y 2
>>> func(1, 2, 3, 4)
Traceback (most recent call last):
...
    File "/usr/local/lib/python3.3/inspect.py", line 1972, in _bind
        raise TypeError('too many positional arguments')
TypeError: too many positional arguments
>>>
>>> func(y=2)
Traceback (most recent call last):
...
    File "/usr/local/lib/python3.3/inspect.py", line 1961, in _bind
        raise TypeError(msg) from None
TypeError: 'x' parameter lacking default value
>>>
>>> func(1, y=2, x=3)
Traceback (most recent call last):
...
    File "/usr/local/lib/python3.3/inspect.py", line 1985, in _bind
        '{arg!r}'.format(arg=param.name))
TypeError: multiple values for argument 'x'
>>>
```

å¯ä»¥çœ‹å‡ºæ¥ï¼Œé€šè¿‡å°†ç­¾åå’Œä¼ é€’çš„å‚æ•°ç»‘å®šèµ·æ¥ï¼Œå¯ä»¥å¼ºåˆ¶å‡½æ•°è°ƒç”¨éµå¾ªç‰¹å®šçš„è§„åˆ™ï¼Œæ¯”å¦‚å¿…å¡«ã€é»˜è®¤ã€é‡å¤ç­‰ç­‰ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªå¼ºåˆ¶å‡½æ•°ç­¾åæ›´å…·ä½“çš„ä¾‹å­ã€‚åœ¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬åœ¨åŸºç±»ä¸­å…ˆå®šä¹‰äº†ä¸€ä¸ªéå¸¸é€šç”¨çš„ `__init__()` æ–¹æ³•ï¼Œ ç„¶åæˆ‘ä»¬å¼ºåˆ¶æ‰€æœ‰çš„å­ç±»å¿…é¡»æä¾›ä¸€ä¸ªç‰¹å®šçš„å‚æ•°ç­¾åã€‚
```python
from inspect import Signature, Parameter

def make_sig(*names):
    parms = [Parameter(name, Parameter.POSITIONAL_OR_KEYWORD)
            for name in names]
    return Signature(parms)

class Structure:
    __signature__ = make_sig()
    def __init__(self, *args, **kwargs):
        bound_values = self.__signature__.bind(*args, **kwargs)
        for name, value in bound_values.arguments.items():
            setattr(self, name, value)

# Example use
class Stock(Structure):
    __signature__ = make_sig('name', 'shares', 'price')

class Point(Structure):
    __signature__ = make_sig('x', 'y')


>>> import inspect
>>> print(inspect.signature(Stock))
(name, shares, price)
>>> s1 = Stock('ACME', 100, 490.1)
>>> s2 = Stock('ACME', 100)
Traceback (most recent call last):
...
TypeError: 'price' parameter lacking default value
>>> s3 = Stock('ACME', 100, 490.1, shares=50)
Traceback (most recent call last):
...
TypeError: multiple values for argument 'shares'
>>>
```

åœ¨æˆ‘ä»¬éœ€è¦æ„å»ºé€šç”¨å‡½æ•°åº“ã€ç¼–å†™è£…é¥°å™¨æˆ–å®ç°ä»£ç†çš„æ—¶å€™ï¼Œå¯¹äº `*args` å’Œ `**kwargs` çš„ä½¿ç”¨æ˜¯å¾ˆæ™®éçš„ã€‚ ä½†æ˜¯ï¼Œè¿™æ ·çš„å‡½æ•°æœ‰ä¸€ä¸ªç¼ºç‚¹å°±æ˜¯å½“æƒ³è¦å®ç°è‡ªå·±çš„å‚æ•°æ£€éªŒæ—¶ï¼Œä»£ç å°±ä¼šç¬¨æ‹™æ··ä¹±ã€‚è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªç­¾åå¯¹è±¡æ¥ç®€åŒ–å®ƒã€‚

åœ¨æœ€åçš„ä¸€ä¸ªæ–¹æ¡ˆå®ä¾‹ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ä½¿ç”¨è‡ªå®šä¹‰å…ƒç±»æ¥åˆ›å»ºç­¾åå¯¹è±¡ã€‚ä¸‹é¢æ¼”ç¤ºæ€æ ·æ¥å®ç°ï¼š
```python
from inspect import Signature, Parameter

def make_sig(*names):
    parms = [Parameter(name, Parameter.POSITIONAL_OR_KEYWORD)
            for name in names]
    return Signature(parms)

class StructureMeta(type):
    def __new__(cls, clsname, bases, clsdict):
        clsdict['__signature__'] = make_sig(*clsdict.get('_fields',[]))
        return super().__new__(cls, clsname, bases, clsdict)

class Structure(metaclass=StructureMeta):
    _fields = []
    def __init__(self, *args, **kwargs):
        bound_values = self.__signature__.bind(*args, **kwargs)
        for name, value in bound_values.arguments.items():
            setattr(self, name, value)

# Example
class Stock(Structure):
    _fields = ['name', 'shares', 'price']

class Point(Structure):
    _fields = ['x', 'y']
```

å½“æˆ‘ä»¬è‡ªå®šä¹‰ç­¾åçš„æ—¶å€™ï¼Œå°†ç­¾åå­˜å‚¨åœ¨ç‰¹å®šçš„å±æ€§ `__signature__` ä¸­é€šå¸¸æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚ è¿™æ ·çš„è¯ï¼Œåœ¨ä½¿ç”¨ inspect æ¨¡å—æ‰§è¡Œå†…çœçš„ä»£ç å°±èƒ½å‘ç°ç­¾åå¹¶å°†å®ƒä½œä¸ºè°ƒç”¨çº¦å®šã€‚
```python
>>> import inspect
>>> print(inspect.signature(Stock))
(name, shares, price)
>>> print(inspect.signature(Point))
(x, y)
>>>
```

ğŸ§© è¢«åŒ…è£…å‡½æ•°çš„å‡½æ•°ç­¾åå¦‚ä½•é‡æ–°ç»‘å®šä¸ºæ­£ç¡®çš„ï¼Œå¦‚ä¸‹ï¼š
```python
from functools import wraps
import inspect

def optional_debug(func):
    if 'debug' in inspect.getargspec(func).args:
        raise TypeError('debug argument already defined')

    @wraps(func)
    def wrapper(*args, debug=False, **kwargs):
        if debug:
            print('Calling', func.__name__)
        return func(*args, **kwargs)

    sig = inspect.signature(func)
    parms = list(sig.parameters.values())
    parms.append(inspect.Parameter('debug',
                inspect.Parameter.KEYWORD_ONLY,
                default=False))
    wrapper.__signature__ = sig.replace(parameters=parms)
    return wrapper
```

é€šè¿‡è¿™æ ·çš„ä¿®æ”¹ï¼ŒåŒ…è£…åçš„å‡½æ•°ç­¾åå°±èƒ½æ­£ç¡®çš„æ˜¾ç¤º `debug` å‚æ•°çš„å­˜åœ¨äº†ã€‚ä¾‹å¦‚ï¼š
```python
>>> @optional_debug
... def add(x,y):
...     return x+y
...
>>> print(inspect.signature(add))
(x, y, *, debug=False)
>>> add(2,3)
5
>>>
```





### ğŸ itertools æ¨¡å—

#### ğŸ¯ islice()

ç”¨äº è¿­ä»£å™¨å’Œç”Ÿæˆå™¨ ä¸Šçš„åˆ‡ç‰‡æ“ä½œã€‚

#### ğŸ¯ dropwhile()

ç”¨äºä¸¢å¼ƒä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡å‰é¢çš„å…ƒç´ ã€‚

#### ğŸ¯ permutations()/combinations()/combinations_with_replacement()

æ’åˆ—ç»„åˆçš„è¿­ä»£ï¼ˆè¿­ä»£éå†ä¸€ä¸ªé›†åˆä¸­å…ƒç´ çš„æ‰€æœ‰å¯èƒ½çš„æ’åˆ—æˆ–ç»„åˆï¼‰ã€‚

#### ğŸ¯ zip_longest()

åŒæ—¶è¿­ä»£å¤šä¸ªåºåˆ—ï¼Œå¹¶ä¸”å¯¹å…¶é•¿åº¦ã€‚

#### ğŸ¯ chain()

åˆå¹¶å¤šä¸ªé›†åˆï¼Œåˆ›å»ºè¿­ä»£å™¨ã€‚

#### ğŸ¯ groupby()
æœ‰ä¸€ä¸ªå­—å…¸æˆ–è€…å®ä¾‹çš„åºåˆ—ï¼Œç„¶åæƒ³æ ¹æ®æŸä¸ªç‰¹å®šçš„å­—æ®µæ¯”å¦‚ date æ¥åˆ†ç»„è¿­ä»£è®¿é—®ã€‚

`itertools.groupby()` å‡½æ•°å¯¹äºè¿™æ ·çš„æ•°æ®åˆ†ç»„æ“ä½œéå¸¸å®ç”¨ã€‚

```python
rows = [
    {'address': '5412 N CLARK', 'date': '07/01/2012'},
    {'address': '5148 N CLARK', 'date': '07/04/2012'},
    {'address': '5800 E 58TH', 'date': '07/02/2012'},
    {'address': '2122 N CLARK', 'date': '07/03/2012'},
    {'address': '5645 N RAVENSWOOD', 'date': '07/02/2012'},
    {'address': '1060 W ADDISON', 'date': '07/02/2012'},
    {'address': '4801 N BROADWAY', 'date': '07/01/2012'},
    {'address': '1039 W GRANVILLE', 'date': '07/04/2012'},
]

from operator import itemgetter
from itertools import groupby

# Sort by the desired field first
rows.sort(key=itemgetter('date'))
# Iterate in groups
for date, items in groupby(rows, key=itemgetter('date')):
    print(date)
    for i in items:
        print(' ', i)
```
è¿è¡Œç»“æœï¼š
```
07/01/2012
  {'date': '07/01/2012', 'address': '5412 N CLARK'}
  {'date': '07/01/2012', 'address': '4801 N BROADWAY'}
07/02/2012
  {'date': '07/02/2012', 'address': '5800 E 58TH'}
  {'date': '07/02/2012', 'address': '5645 N RAVENSWOOD'}
  {'date': '07/02/2012', 'address': '1060 W ADDISON'}
07/03/2012
  {'date': '07/03/2012', 'address': '2122 N CLARK'}
07/04/2012
  {'date': '07/04/2012', 'address': '5148 N CLARK'}
  {'date': '07/04/2012', 'address': '1039 W GRANVILLE'}
```

#### ğŸ¯ compress()
å®ƒä»¥ä¸€ä¸ª iterable å¯¹è±¡å’Œä¸€ä¸ªç›¸å¯¹åº”çš„ Boolean é€‰æ‹©å™¨åºåˆ—ä½œä¸ºè¾“å…¥å‚æ•°ã€‚ ç„¶åè¾“å‡º iterable å¯¹è±¡ä¸­å¯¹åº”é€‰æ‹©å™¨ä¸º True çš„å…ƒç´ ã€‚ å½“éœ€è¦ç”¨å¦å¤–ä¸€ä¸ªç›¸å…³è”çš„åºåˆ—æ¥è¿‡æ»¤æŸä¸ªåºåˆ—çš„æ—¶å€™ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ æ¯”å¦‚ï¼š
```python
addresses = [
    '5412 N CLARK',
    '5148 N CLARK',
    '5800 E 58TH',
    '2122 N CLARK',
    '5645 N RAVENSWOOD',
    '1060 W ADDISON',
    '4801 N BROADWAY',
    '1039 W GRANVILLE',
]
counts = [ 0, 3, 10, 4, 1, 7, 6, 1]
```
å°†é‚£äº›å¯¹åº” count å€¼å¤§äº5çš„åœ°å€å…¨éƒ¨è¾“å‡ºï¼Œå¯ä»¥è¿™æ ·åšï¼š
```python
>>> from itertools import compress
>>> more5 = [n > 5 for n in counts]
>>> more5
[False, False, True, False, False, True, True, False]
>>> list(compress(addresses, more5))
['5800 E 58TH', '1060 W ADDISON', '4801 N BROADWAY']
>>>
```

è¿™é‡Œçš„å…³é”®ç‚¹åœ¨äºå…ˆåˆ›å»ºä¸€ä¸ª `Boolean` åºåˆ—ï¼ŒæŒ‡ç¤ºå“ªäº›å…ƒç´ ç¬¦åˆæ¡ä»¶ã€‚ ç„¶å `compress()` å‡½æ•°æ ¹æ®è¿™ä¸ªåºåˆ—å»é€‰æ‹©è¾“å‡ºå¯¹åº”ä½ç½®ä¸º `True` çš„å…ƒç´ ã€‚

å’Œ `filter()` å‡½æ•°ç±»ä¼¼ï¼Œ `compress()` ä¹Ÿæ˜¯è¿”å›çš„ä¸€ä¸ªè¿­ä»£å™¨ã€‚å› æ­¤ï¼Œå¦‚æœéœ€è¦å¾—åˆ°ä¸€ä¸ªåˆ—è¡¨ï¼Œ é‚£ä¹ˆéœ€è¦ä½¿ç”¨ `list()` æ¥å°†ç»“æœè½¬æ¢ä¸ºåˆ—è¡¨ç±»å‹ã€‚

### ğŸ ipaddress æ¨¡å—

#### ğŸ¯ é€šè¿‡CIDRåœ°å€ç”Ÿæˆå¯¹åº”çš„IPåœ°å€é›†

æœ‰ä¸€ä¸ªCIDRç½‘ç»œåœ°å€æ¯”å¦‚â€œ123.45.67.89/27â€ï¼Œæƒ³å°†å…¶è½¬æ¢æˆå®ƒæ‰€ä»£è¡¨çš„æ‰€æœ‰IP ï¼ˆæ¯”å¦‚ï¼Œâ€œ123.45.67.64â€, â€œ123.45.67.65â€, â€¦, â€œ123.45.67.95â€ï¼‰

å¯ä»¥ä½¿ç”¨ `ipaddress` æ¨¡å—å¾ˆå®¹æ˜“çš„å®ç°è¿™æ ·çš„è®¡ç®—ã€‚ä¾‹å¦‚ï¼š
```python
>>> import ipaddress
>>> net = ipaddress.ip_network('123.45.67.64/27')
>>> net
IPv4Network('123.45.67.64/27')
>>> for a in net:
...     print(a)
...
123.45.67.64
123.45.67.65
123.45.67.66
123.45.67.67
123.45.67.68
...
123.45.67.95
>>>

>>> net6 = ipaddress.ip_network('12:3456:78:90ab:cd:ef01:23:30/125')
>>> net6
IPv6Network('12:3456:78:90ab:cd:ef01:23:30/125')
>>> for a in net6:
...     print(a)
...
12:3456:78:90ab:cd:ef01:23:30
12:3456:78:90ab:cd:ef01:23:31
12:3456:78:90ab:cd:ef01:23:32
12:3456:78:90ab:cd:ef01:23:33
12:3456:78:90ab:cd:ef01:23:34
12:3456:78:90ab:cd:ef01:23:35
12:3456:78:90ab:cd:ef01:23:36
12:3456:78:90ab:cd:ef01:23:37
>>>
```

`Network` ä¹Ÿå…è®¸åƒæ•°ç»„ä¸€æ ·çš„ç´¢å¼•å–å€¼ï¼Œä¾‹å¦‚ï¼š

```python
>>> net.num_addresses
32
>>> net[0]

IPv4Address('123.45.67.64')
>>> net[1]
IPv4Address('123.45.67.65')
>>> net[-1]
IPv4Address('123.45.67.95')
>>> net[-2]
IPv4Address('123.45.67.94')
>>>
```

å¦å¤–ï¼Œè¿˜å¯ä»¥æ‰§è¡Œç½‘ç»œæˆå‘˜æ£€æŸ¥ä¹‹ç±»çš„æ“ä½œï¼š

```python
>>> a = ipaddress.ip_address('123.45.67.69')
>>> a in net
True
>>> b = ipaddress.ip_address('123.45.67.123')
>>> b in net
False
>>>
```

ä¸€ä¸ªIPåœ°å€å’Œç½‘ç»œåœ°å€èƒ½é€šè¿‡ä¸€ä¸ªIPæ¥å£æ¥æŒ‡å®šï¼Œä¾‹å¦‚ï¼š

```python
>>> inet = ipaddress.ip_interface('123.45.67.73/27')
>>> inet.network
IPv4Network('123.45.67.64/27')
>>> inet.ip
IPv4Address('123.45.67.73')
>>>
```

âš ï¸ `ipaddress` æ¨¡å—æœ‰å¾ˆå¤šç±»å¯ä»¥è¡¨ç¤ºIPåœ°å€ã€ç½‘ç»œå’Œæ¥å£ã€‚ å½“éœ€è¦æ“ä½œç½‘ç»œåœ°å€ï¼ˆæ¯”å¦‚è§£æã€æ‰“å°ã€éªŒè¯ç­‰ï¼‰çš„æ—¶å€™ä¼šå¾ˆæœ‰ç”¨ã€‚

è¦æ³¨æ„çš„æ˜¯ï¼Œ`ipaddress` æ¨¡å—è·Ÿå…¶ä»–ä¸€äº›å’Œç½‘ç»œç›¸å…³çš„æ¨¡å—æ¯”å¦‚ `socket` åº“äº¤é›†å¾ˆå°‘ã€‚ æ‰€ä»¥ï¼Œä¸èƒ½ä½¿ç”¨ `IPv4Address` çš„å®ä¾‹æ¥ä»£æ›¿ä¸€ä¸ªåœ°å€å­—ç¬¦ä¸²ï¼Œé¦–å…ˆå¾—æ˜¾å¼çš„ä½¿ç”¨ `str()` è½¬æ¢å®ƒã€‚ä¾‹å¦‚ï¼š

```python
>>> a = ipaddress.ip_address('127.0.0.1')
>>> from socket import socket, AF_INET, SOCK_STREAM
>>> s = socket(AF_INET, SOCK_STREAM)
>>> s.connect((a, 8080))
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
TypeError: Can't convert 'IPv4Address' object to str implicitly
>>> s.connect((str(a), 8080))
>>>
```




### ğŸ json æ¨¡å—

### ğŸ logging æ¨¡å—

### ğŸ math æ¨¡å—
#### ğŸ¯ æ•°å­¦å‡½æ•°
```python
import math
print(f"math.ceil(3.2) = {math.ceil(3.2)}")  # è¾“å‡º: math.ceil(3.2) = 4 (å‘ä¸Šå–æ•´)
print(f"math.floor(3.8) = {math.floor(3.8)}")  # è¾“å‡º: math.floor(3.8) = 3 (å‘ä¸‹å–æ•´)
print(f"math.trunc(-3.7) = {math.trunc(-3.7)}")  # è¾“å‡º: math.trunc(-3.7) = -3 (æˆªæ–­å°æ•°éƒ¨åˆ†)
```


### ğŸ numbers æ¨¡å—

æä¾›äº†ä¸€ä¸ªç±»ä¼¼çš„è·Ÿæ•´æ•°ç±»å‹ç›¸å…³çš„æŠ½è±¡ç±»å‹é›†åˆã€‚ 



### ğŸ os æ¨¡å—

#### ğŸ¯ å…«è¿›åˆ¶
```python
>>> import os
>>> os.chmod('script.py', 0755)
    File "<stdin>", line 1
        os.chmod('script.py', 0755)
                            ^
SyntaxError: invalid token
>>>

# éœ€ç¡®ä¿å…«è¿›åˆ¶æ•°çš„å‰ç¼€æ˜¯ 0o 
>>> os.chmod('script.py', 0o755)
>>>
```

#### ğŸ¯ æ–‡ä»¶åçš„æ“ä½œ
å¯¹äºä»»ä½•çš„æ–‡ä»¶åçš„æ“ä½œï¼Œéƒ½åº”è¯¥ä½¿ç”¨ `os.path` æ¨¡å—ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ ‡å‡†å­—ç¬¦ä¸²æ“ä½œæ¥æ„é€ è‡ªå·±çš„ä»£ç ã€‚
```python
>>> import os
>>> path = '/Users/beazley/Data/data.csv'

>>> # Get the last component of the path
>>> os.path.basename(path)
'data.csv'

>>> # Get the directory name
>>> os.path.dirname(path)
'/Users/beazley/Data'

>>> # Join path components together
>>> os.path.join('tmp', 'data', os.path.basename(path))
'tmp/data/data.csv'

>>> # Expand the user's home directory
>>> path = '~/Data/data.csv'
>>> os.path.expanduser(path)
'/Users/beazley/Data/data.csv'

>>> # Split the file extension
>>> os.path.splitext(path)
('~/Data/data', '.csv')
>>>
```

#### ğŸ¯ æµ‹è¯•æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ä½¿ç”¨ `os.path` æ¥è¿›è¡Œæ–‡ä»¶æµ‹è¯•æ˜¯å¾ˆç®€å•çš„ã€‚ä½†æ˜¯è¦æ³¨æ„æ–‡ä»¶æƒé™é—®é¢˜ã€‚
```python
>>> import os
>>> os.path.exists('/etc/passwd')
True
>>> os.path.exists('/tmp/spam')
False
>>>

>>> # Is a regular file
>>> os.path.isfile('/etc/passwd')
True

>>> # Is a directory
>>> os.path.isdir('/etc/passwd')
False

>>> # Is a symbolic link
>>> os.path.islink('/usr/local/bin/python3')
True

>>> # Get the file linked to
>>> os.path.realpath('/usr/local/bin/python3')
'/usr/local/bin/python3.3'
>>>

>>> os.path.getsize('/etc/passwd')
3669
>>> os.path.getmtime('/etc/passwd')
1272478234.0
>>> import time
>>> time.ctime(os.path.getmtime('/etc/passwd'))
'Wed Apr 28 13:10:34 2010'
>>>
```

#### ğŸ¯ æ‰“å°ä¸åˆæ³•æ–‡ä»¶å
ç¨‹åºè·å–äº†ä¸€ä¸ªç›®å½•ä¸­çš„æ–‡ä»¶ååˆ—è¡¨ï¼Œä½†æ˜¯å½“å®ƒè¯•ç€å»æ‰“å°æ–‡ä»¶åçš„æ—¶å€™ç¨‹åºå´©æºƒï¼Œ å‡ºç°äº† `UnicodeEncodeError` å¼‚å¸¸å’Œä¸€æ¡å¥‡æ€ªçš„æ¶ˆæ¯â€”â€” `surrogates not allowed`ã€‚

å½“æ‰“å°æœªçŸ¥çš„æ–‡ä»¶åæ—¶ï¼Œä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•å¯ä»¥é¿å…è¿™æ ·çš„é”™è¯¯ï¼š

```python
def bad_filename(filename):
    return repr(filename)[1:-1]

try:
    print(filename)
except UnicodeEncodeError:
    print(bad_filename(filename))
```
è¿™é‡Œè®¨è®ºçš„æ˜¯åœ¨ç¼–å†™å¿…é¡»å¤„ç†æ–‡ä»¶ç³»ç»Ÿçš„ç¨‹åºæ—¶ä¸€ä¸ªä¸å¤ªå¸¸è§ä½†åˆå¾ˆæ£˜æ‰‹çš„é—®é¢˜ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒPython å‡å®šæ‰€æœ‰æ–‡ä»¶åéƒ½å·²ç»æ ¹æ® `sys.getfilesystemencoding()` çš„å€¼ç¼–ç è¿‡äº†ã€‚ ä½†æ˜¯ï¼Œæœ‰ä¸€äº›æ–‡ä»¶ç³»ç»Ÿå¹¶æ²¡æœ‰å¼ºåˆ¶è¦æ±‚è¿™æ ·åšï¼Œå› æ­¤å…è®¸åˆ›å»ºæ–‡ä»¶åæ²¡æœ‰æ­£ç¡®ç¼–ç çš„æ–‡ä»¶ã€‚ è¿™ç§æƒ…å†µä¸å¤ªå¸¸è§ï¼Œä½†æ˜¯æ€»ä¼šæœ‰äº›ç”¨æˆ·å†’é™©è¿™æ ·åšæˆ–è€…æ˜¯æ— æ„ä¹‹ä¸­è¿™æ ·åšäº†( å¯èƒ½æ˜¯åœ¨ä¸€ä¸ªæœ‰ç¼ºé™·çš„ä»£ç ä¸­ç»™ open() å‡½æ•°ä¼ é€’äº†ä¸€ä¸ªä¸åˆè§„èŒƒçš„æ–‡ä»¶å)ã€‚

å½“æ‰§è¡Œç±»ä¼¼ `os.listdir()` è¿™æ ·çš„å‡½æ•°æ—¶ï¼Œè¿™äº›ä¸åˆè§„èŒƒçš„æ–‡ä»¶åå°±ä¼šè®©Pythoné™·å…¥å›°å¢ƒã€‚ ä¸€æ–¹é¢ï¼Œå®ƒä¸èƒ½ä»…ä»…åªæ˜¯ä¸¢å¼ƒè¿™äº›ä¸åˆæ ¼çš„åå­—ã€‚è€Œå¦ä¸€æ–¹é¢ï¼Œå®ƒåˆä¸èƒ½å°†è¿™äº›æ–‡ä»¶åè½¬æ¢ä¸ºæ­£ç¡®çš„æ–‡æœ¬å­—ç¬¦ä¸²ã€‚ Pythonå¯¹è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆæ˜¯ä»æ–‡ä»¶åä¸­è·å–æœªè§£ç çš„å­—èŠ‚å€¼æ¯”å¦‚ `\xhh `å¹¶å°†å®ƒæ˜ å°„æˆUnicodeå­—ç¬¦ `\udchh` è¡¨ç¤ºçš„æ‰€è°“çš„â€ä»£ç†ç¼–ç â€ã€‚ ä¸‹é¢ä¸€ä¸ªä¾‹å­æ¼”ç¤ºäº†å½“ä¸€ä¸ªä¸åˆæ ¼ç›®å½•åˆ—è¡¨ä¸­å«æœ‰ä¸€ä¸ªæ–‡ä»¶åä¸ºbÃ¤d.txt(ä½¿ç”¨Latin-1è€Œä¸æ˜¯UTF-8ç¼–ç )æ—¶çš„æ ·å­ï¼š
```python
>>> import os
>>> files = os.listdir('.')
>>> files
['spam.py', 'b\udce4d.txt', 'foo.txt']
>>>
```
å¦‚æœæœ‰ä»£ç éœ€è¦æ“ä½œæ–‡ä»¶åæˆ–è€…å°†æ–‡ä»¶åä¼ é€’ç»™ `open()` è¿™æ ·çš„å‡½æ•°ï¼Œä¸€åˆ‡éƒ½èƒ½æ­£å¸¸å·¥ä½œã€‚ åªæœ‰å½“æƒ³è¦è¾“å‡ºæ–‡ä»¶åæ—¶æ‰ä¼šç¢°åˆ°äº›éº»çƒ¦(æ¯”å¦‚æ‰“å°è¾“å‡ºåˆ°å±å¹•æˆ–æ—¥å¿—æ–‡ä»¶ç­‰)ã€‚ ç‰¹åˆ«çš„ï¼Œå½“æƒ³æ‰“å°ä¸Šé¢çš„æ–‡ä»¶ååˆ—è¡¨æ—¶ï¼Œç¨‹åºå°±ä¼šå´©æºƒï¼š
```python
>>> for name in files:
...     print(name)
...
spam.py
Traceback (most recent call last):
    File "<stdin>", line 2, in <module>
UnicodeEncodeError: 'utf-8' codec can't encode character '\udce4' in
position 1: surrogates not allowed
>>>
```
ç¨‹åºå´©æºƒçš„åŸå› å°±æ˜¯å­—ç¬¦ `\udce4` æ˜¯ä¸€ä¸ªéæ³•çš„Unicodeå­—ç¬¦ã€‚ å®ƒå…¶å®æ˜¯ä¸€ä¸ªè¢«ç§°ä¸ºä»£ç†å­—ç¬¦å¯¹çš„åŒå­—ç¬¦ç»„åˆçš„ååŠéƒ¨åˆ†ã€‚ ç”±äºç¼ºå°‘äº†å‰åŠéƒ¨åˆ†ï¼Œå› æ­¤å®ƒæ˜¯ä¸ªéæ³•çš„Unicodeã€‚ æ‰€ä»¥ï¼Œå”¯ä¸€èƒ½æˆåŠŸè¾“å‡ºçš„æ–¹æ³•å°±æ˜¯å½“é‡åˆ°ä¸åˆæ³•æ–‡ä»¶åæ—¶é‡‡å–ç›¸åº”çš„è¡¥æ•‘æªæ–½ã€‚ æ¯”å¦‚å¯ä»¥å°†ä¸Šè¿°ä»£ç ä¿®æ”¹å¦‚ä¸‹ï¼š
```python
>>> for name in files:
... try:
...     print(name)
... except UnicodeEncodeError:
...     print(bad_filename(name))
...
spam.py
b\udce4d.txt
foo.txt
>>>
```
åœ¨ `bad_filename()` å‡½æ•°ä¸­æ€æ ·å¤„ç½®å–å†³äºè‡ªå·±ã€‚ å¦å¤–ä¸€ä¸ªé€‰æ‹©å°±æ˜¯é€šè¿‡æŸç§æ–¹å¼é‡æ–°ç¼–ç ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š
```python
def bad_filename(filename):
    temp = filename.encode(sys.getfilesystemencoding(), errors='surrogateescape')
    return temp.decode('latin-1')
```
æ³¨ï¼š
```
surrogateescape:
è¿™ç§æ˜¯Pythonåœ¨ç»å¤§éƒ¨åˆ†é¢å‘OSçš„APIä¸­æ‰€ä½¿ç”¨çš„é”™è¯¯å¤„ç†å™¨ï¼Œ
å®ƒèƒ½ä»¥ä¸€ç§ä¼˜é›…çš„æ–¹å¼å¤„ç†ç”±æ“ä½œç³»ç»Ÿæä¾›çš„æ•°æ®çš„ç¼–ç é—®é¢˜ã€‚
åœ¨è§£ç å‡ºé”™æ—¶ä¼šå°†å‡ºé”™å­—èŠ‚å­˜å‚¨åˆ°ä¸€ä¸ªå¾ˆå°‘è¢«ä½¿ç”¨åˆ°çš„Unicodeç¼–ç èŒƒå›´å†…ã€‚
åœ¨ç¼–ç æ—¶å°†é‚£äº›éšè—å€¼åˆè¿˜åŸå›åŸå…ˆè§£ç å¤±è´¥çš„å­—èŠ‚åºåˆ—ã€‚
å®ƒä¸ä»…å¯¹äºOS APIéå¸¸æœ‰ç”¨ï¼Œä¹Ÿèƒ½å¾ˆå®¹æ˜“çš„å¤„ç†å…¶ä»–æƒ…å†µä¸‹çš„ç¼–ç é”™è¯¯ã€‚
```
ä½¿ç”¨è¿™ä¸ªç‰ˆæœ¬äº§ç”Ÿçš„è¾“å‡ºå¦‚ä¸‹ï¼š
```python
>>> for name in files:
...     try:
...         print(name)
...     except UnicodeEncodeError:
...         print(bad_filename(name))
...
spam.py
bÃ¤d.txt
foo.txt
>>>
```





### ğŸ operator æ¨¡å—

#### ğŸ¯ methodcaller()
é€šè¿‡å­—ç¬¦ä¸²è°ƒç”¨å¯¹è±¡æ–¹æ³•

æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²å½¢å¼çš„æ–¹æ³•åç§°ï¼Œæƒ³é€šè¿‡å®ƒè°ƒç”¨æŸä¸ªå¯¹è±¡çš„å¯¹åº”æ–¹æ³•ã€‚æœ€ç®€å•çš„æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ getattr() ï¼š
```python
import math

class Point:
    def __init__(self, x, y):
        self.x = x
        self.y = y

    def __repr__(self):
        return 'Point({!r:},{!r:})'.format(self.x, self.y)

    def distance(self, x, y):
        return math.hypot(self.x - x, self.y - y)


p = Point(2, 3)
d = getattr(p, 'distance')(0, 0)  # Calls p.distance(0, 0)
```

å¦å¤–ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ `operator.methodcaller()` ï¼Œä¾‹å¦‚ï¼š
```python
import operator
operator.methodcaller('distance', 0, 0)(p)
```

å½“éœ€è¦é€šè¿‡ç›¸åŒçš„å‚æ•°å¤šæ¬¡è°ƒç”¨æŸä¸ªæ–¹æ³•æ—¶ï¼Œä½¿ç”¨ `operator.methodcaller` å°±å¾ˆæ–¹ä¾¿äº†ã€‚ æ¯”å¦‚éœ€è¦æ’åºä¸€ç³»åˆ—çš„ç‚¹ï¼Œå°±å¯ä»¥è¿™æ ·åšï¼š
```python
points = [
    Point(1, 2),
    Point(3, 0),
    Point(10, -3),
    Point(-5, -7),
    Point(-1, 8),
    Point(3, 2)
]
# Sort by distance from origin (0, 0)
points.sort(key=operator.methodcaller('distance', 0, 0))
```

è°ƒç”¨ä¸€ä¸ªæ–¹æ³•å®é™…ä¸Šæ˜¯ä¸¤æ­¥ç‹¬ç«‹æ“ä½œï¼Œç¬¬ä¸€æ­¥æ˜¯æŸ¥æ‰¾å±æ€§ï¼Œç¬¬äºŒæ­¥æ˜¯å‡½æ•°è°ƒç”¨ã€‚ å› æ­¤ï¼Œä¸ºäº†è°ƒç”¨æŸä¸ªæ–¹æ³•ï¼Œå¯ä»¥é¦–å…ˆé€šè¿‡ `getattr()` æ¥æŸ¥æ‰¾åˆ°è¿™ä¸ªå±æ€§ï¼Œç„¶åå†å»ä»¥å‡½æ•°æ–¹å¼è°ƒç”¨å®ƒå³å¯ã€‚

`operator.methodcaller() `åˆ›å»ºä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼Œå¹¶åŒæ—¶æä¾›æ‰€æœ‰å¿…è¦å‚æ•°ï¼Œ ç„¶åè°ƒç”¨çš„æ—¶å€™åªéœ€è¦å°†å®ä¾‹å¯¹è±¡ä¼ é€’ç»™å®ƒå³å¯ï¼Œæ¯”å¦‚ï¼š
```python
>>> p = Point(3, 4)
>>> d = operator.methodcaller('distance', 0, 0)
>>> d(p)
5.0
>>>
```


#### ğŸ¯ itemgetter()
æ ¹æ®æŸä¸ªæˆ–æŸå‡ ä¸ªå­—å…¸å­—æ®µæ¥æ’åºè¿™ä¸ªåˆ—è¡¨ï¼Œé€šè¿‡ä½¿ç”¨`operator`æ¨¡å—çš„`itemgetter`å‡½æ•°ï¼Œå¯ä»¥éå¸¸å®¹æ˜“çš„æ’åºè¿™æ ·çš„æ•°æ®ç»“æ„ï¼š
```python
rows = [
    {'fname': 'Brian', 'lname': 'Jones', 'uid': 1003},
    {'fname': 'David', 'lname': 'Beazley', 'uid': 1002},
    {'fname': 'John', 'lname': 'Cleese', 'uid': 1001},
    {'fname': 'Big', 'lname': 'Jones', 'uid': 1004}
]

from operator import itemgetter
rows_by_fname = sorted(rows, key=itemgetter('fname'))
rows_by_uid = sorted(rows, key=itemgetter('uid'))
```
`itemgetter()`æœ‰æ—¶å€™ä¹Ÿå¯ä»¥ç”¨`lambda`è¡¨è¾¾å¼ä»£æ›¿ï¼Œæ¯”å¦‚ï¼š
```python
rows_by_fname = sorted(rows, key=lambda r: r['fname'])
rows_by_lfname = sorted(rows, key=lambda r: (r['lname'],r['fname']))
```
ä½¿ç”¨`itemgetter()`æ–¹å¼ä¼šè¿è¡Œçš„ç¨å¾®å¿«ç‚¹ã€‚å› æ­¤ï¼Œå¦‚æœå¯¹æ€§èƒ½è¦æ±‚æ¯”è¾ƒé«˜çš„è¯å°±ä½¿ç”¨`itemgetter()`æ–¹å¼ã€‚
```python
>>> min(rows, key=itemgetter('uid'))
{'fname': 'John', 'lname': 'Cleese', 'uid': 1001}
>>> max(rows, key=itemgetter('uid'))
{'fname': 'Big', 'lname': 'Jones', 'uid': 1004}
>>>
```

#### ğŸ¯ attrgetter()
æ’åºç±»å‹ç›¸åŒçš„å¯¹è±¡ï¼Œä½†æ˜¯ä»–ä»¬ä¸æ”¯æŒåŸç”Ÿçš„æ¯”è¾ƒæ“ä½œã€‚

å†…ç½®çš„ `sorted()` å‡½æ•°æœ‰ä¸€ä¸ªå…³é”®å­—å‚æ•° `key` ï¼Œå¯ä»¥ä¼ å…¥ä¸€ä¸ª `callable` å¯¹è±¡ç»™å®ƒï¼Œ è¿™ä¸ª `callable` å¯¹è±¡å¯¹æ¯ä¸ªä¼ å…¥çš„å¯¹è±¡è¿”å›ä¸€ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼ä¼šè¢« `sorted` ç”¨æ¥æ’åºè¿™äº›å¯¹è±¡ã€‚ æ¯”å¦‚ï¼Œå¦‚æœåœ¨åº”ç”¨ç¨‹åºé‡Œé¢æœ‰ä¸€ä¸ª `User` å®ä¾‹åºåˆ—ï¼Œå¹¶ä¸”å¸Œæœ›é€šè¿‡ä»–ä»¬çš„ `user_id` å±æ€§è¿›è¡Œæ’åºï¼Œ å¯ä»¥æä¾›ä¸€ä¸ªä»¥ `User` å®ä¾‹ä½œä¸ºè¾“å…¥å¹¶è¾“å‡ºå¯¹åº” `user_id` å€¼çš„ `callable` å¯¹è±¡ã€‚

```python
class User:
    def __init__(self, user_id):
        self.user_id = user_id

    def __repr__(self):
        return 'User({})'.format(self.user_id)


sorted(users, key=lambda u: u.user_id)      # [User(3), User(23), User(99)]

from operator import attrgetter
sorted(users, key=attrgetter('user_id'))    # [User(3), User(23), User(99)]
```






### ğŸ re æ¨¡å—

#### ğŸ¯ æ­£åˆ™

- æœ€çŸ­åŒ¹é…æ¨¡å¼ï¼ˆéè´ªå©ªï¼‰
- å¤šè¡ŒåŒ¹é…ï¼ˆ`re.compile(r'/\*(.*?)\*/', re.DOTALL)` æˆ–è€… `(?:.|\n)` æŒ‡å®šä¸€ä¸ªéæ•è·ç»„ï¼‰

#### ğŸ¯ æŸ¥æ‰¾
å¦‚æœæƒ³åŒ¹é…çš„æ˜¯å­—é¢å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆé€šå¸¸åªéœ€è¦è°ƒç”¨åŸºæœ¬å­—ç¬¦ä¸²æ–¹æ³•å°±è¡Œï¼Œ æ¯”å¦‚ `str.find()` , `str.endswith()` , `str.startswith()` ã€‚

å¤æ‚çš„åŒ¹é…éœ€è¦ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å’Œ re æ¨¡å—ã€‚

```python
>>> text1 = '11/27/2012'
>>> text2 = 'Nov 27, 2012'
>>>
>>> import re
>>> # Simple matching: \d+ means match one or more digits
>>> if re.match(r'\d+/\d+/\d+', text1):
... print('yes')
... else:
... print('no')
...

```
å¦‚æœæƒ³ä½¿ç”¨åŒä¸€ä¸ªæ¨¡å¼å»åšå¤šæ¬¡åŒ¹é…ï¼Œåº”è¯¥å…ˆå°†æ¨¡å¼å­—ç¬¦ä¸²é¢„ç¼–è¯‘ä¸ºæ¨¡å¼å¯¹è±¡ã€‚æ¯”å¦‚ï¼š
```python
>>> datepat = re.compile(r'\d+/\d+/\d+')
>>> if datepat.match(text1):
... print('yes')
... else:
... print('no')
...
```

match() æ€»æ˜¯ä»å­—ç¬¦ä¸²å¼€å§‹å»åŒ¹é…ï¼Œå¦‚æœæƒ³æŸ¥æ‰¾å­—ç¬¦ä¸²ä»»æ„éƒ¨åˆ†çš„æ¨¡å¼å‡ºç°ä½ç½®ï¼Œ ä½¿ç”¨ findall() æ–¹æ³•å»ä»£æ›¿ã€‚

åœ¨å®šä¹‰æ­£åˆ™å¼çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šåˆ©ç”¨æ‹¬å·å»æ•è·åˆ†ç»„ã€‚
```python
>>> datepat = re.compile(r'(\d+)/(\d+)/(\d+)')
>>> text
'Today is 11/27/2012. PyCon starts 3/13/2013.'
>>> datepat.findall(text)
[('11', '27', '2012'), ('3', '13', '2013')]
>>> for month, day, year in datepat.findall(text):
... print('{}-{}-{}'.format(year, month, day))
...
2012-11-27
2013-3-13
>>>
```

`findall()` æ–¹æ³•ä¼šæœç´¢æ–‡æœ¬å¹¶ä»¥åˆ—è¡¨å½¢å¼è¿”å›æ‰€æœ‰çš„åŒ¹é…ã€‚ å¦‚æœæƒ³ä»¥è¿­ä»£æ–¹å¼è¿”å›åŒ¹é…ï¼Œå¯ä»¥ä½¿ç”¨ `finditer()` æ–¹æ³•æ¥ä»£æ›¿ï¼Œæ¯”å¦‚ï¼š
```python
>>> for m in datepat.finditer(text):
... print(m.groups())
...
('11', '27', '2012')
('3', '13', '2013')
>>>
```

#### ğŸ¯ æ›¿æ¢
å¯¹äºç®€å•çš„å­—é¢æ¨¡å¼ï¼Œç›´æ¥ä½¿ç”¨ `str.replace()` æ–¹æ³•å³å¯ï¼Œå¯¹äºå¤æ‚çš„æ¨¡å¼ï¼Œä½¿ç”¨ re æ¨¡å—ä¸­çš„ `sub()` å‡½æ•°ã€‚
```python
>>> text = 'UPPER PYTHON, lower python, Mixed Python'
>>> re.findall('python', text, flags=re.IGNORECASE)
['PYTHON', 'python', 'Python']
>>> re.sub('python', 'snake', text, flags=re.IGNORECASE)
'UPPER snake, lower snake, Mixed snake'
>>>
```
ä¸Šé¢ä¾‹å­æœ‰ä¸ªç¼ºé™·ï¼Œæ›¿æ¢å­—ç¬¦ä¸²å¹¶ä¸ä¼šè‡ªåŠ¨è·Ÿè¢«åŒ¹é…å­—ç¬¦ä¸²çš„å¤§å°å†™ä¿æŒä¸€è‡´ã€‚
```python
def matchcase(word):
    def replace(m):
        text = m.group()
        if text.isupper():
            return word.upper()
        elif text.islower():
            return word.lower()
        elif text[0].isupper():
            return word.capitalize()
        else:
            return word
    return replace

>>> re.sub('python', matchcase('snake'), text, flags=re.IGNORECASE)
'UPPER SNAKE, lower snake, Mixed Snake'
>>>
```
`matchcase('snake')` è¿”å›äº†ä¸€ä¸ªå›è°ƒå‡½æ•°(å‚æ•°å¿…é¡»æ˜¯ `match` å¯¹è±¡)ï¼Œå‰é¢ä¸€èŠ‚æåˆ°è¿‡ï¼Œ `sub()` å‡½æ•°é™¤äº†æ¥å—æ›¿æ¢å­—ç¬¦ä¸²å¤–ï¼Œè¿˜èƒ½æ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚

å¯¹äºä¸€èˆ¬çš„å¿½ç•¥å¤§å°å†™çš„åŒ¹é…æ“ä½œï¼Œç®€å•çš„ä¼ é€’ä¸€ä¸ª re.IGNORECASE æ ‡å¿—å‚æ•°å°±å·²ç»è¶³å¤Ÿäº†ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªå¯¹äºæŸäº›éœ€è¦å¤§å°å†™è½¬æ¢çš„ Unicode åŒ¹é…å¯èƒ½è¿˜ä¸å¤Ÿã€‚

#### ğŸ¯ åœ¨æ­£åˆ™å¼ä¸­ä½¿ç”¨ Unicode
é»˜è®¤æƒ…å†µä¸‹`re`æ¨¡å—å·²ç»å¯¹ä¸€äº› Unicode å­—ç¬¦ç±»æœ‰äº†åŸºæœ¬çš„æ”¯æŒã€‚ æ¯”å¦‚ï¼Œ`\\d` å·²ç»åŒ¹é…ä»»æ„çš„ unicode æ•°å­—å­—ç¬¦äº†ã€‚
```python
>>> import re
>>> num = re.compile('\d+')
>>> # ASCII digits
>>> num.match('123')
<_sre.SRE_Match object at 0x1007d9ed0>
>>> # Arabic digits
>>> num.match('\u0661\u0662\u0663')
<_sre.SRE_Match object at 0x101234030>
>>>
```

æ··åˆä½¿ç”¨Unicodeå’Œæ­£åˆ™è¡¨è¾¾å¼ï¼Œæœ€å¥½è¿˜æ˜¯ä½¿ç”¨å¢å¼ºçš„ç¬¬ä¸‰æ–¹åº“ï¼Œæ¯”å¦‚ï¼š `regex `


#### ğŸ¯ å­—ç¬¦ä¸²ä»¤ç‰Œè§£æ

æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæƒ³ä»å·¦è‡³å³å°†å…¶è§£æä¸ºä¸€ä¸ªä»¤ç‰Œæµã€‚

å¯¹äºå¤æ‚çš„è¯­æ³•ï¼Œæœ€å¥½æ˜¯é€‰æ‹©æŸä¸ªè§£æå·¥å…·æ¯”å¦‚ PyParsing æˆ–è€…æ˜¯ PLYã€‚



### ğŸ random æ¨¡å—
`random`æ¨¡å—æœ‰å¤§é‡çš„å‡½æ•°ç”¨æ¥äº§ç”Ÿéšæœºæ•°å’Œéšæœºé€‰æ‹©å…ƒç´ ã€‚ æ¯”å¦‚ï¼Œè¦æƒ³ä»ä¸€ä¸ªåºåˆ—ä¸­éšæœºçš„æŠ½å–ä¸€ä¸ªå…ƒç´ ï¼Œå¯ä»¥ä½¿ç”¨ random.choice() ï¼š
```python
>>> import random
>>> values = [1, 2, 3, 4, 5, 6]
>>> random.choice(values)
2
>>> random.choice(values)
3
>>> random.choice(values)
1
>>> random.choice(values)
4
>>> random.choice(values)
6
>>>
```
ä¸ºäº†æå–å‡ºNä¸ªä¸åŒå…ƒç´ çš„æ ·æœ¬ç”¨æ¥åšè¿›ä¸€æ­¥çš„æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨ `random.sample()` ï¼š
```python
>>> random.sample(values, 2)
[6, 2]
>>> random.sample(values, 2)
[4, 3]
>>> random.sample(values, 3)
[4, 3, 1]
>>> random.sample(values, 3)
[5, 4, 1]
>>>
```
æ‰“ä¹±åºåˆ—ä¸­å…ƒç´ çš„é¡ºåºï¼Œå¯ä»¥ä½¿ç”¨ `random.shuffle()` ï¼š
```pythoon
>>> random.shuffle(values)
>>> values
[2, 4, 6, 5, 3, 1]
>>> random.shuffle(values)
>>> values
[3, 5, 2, 1, 6, 4]
>>>
```
ç”Ÿæˆéšæœºæ•´æ•°ï¼Œè¯·ä½¿ç”¨ random.randint() ï¼š
```python
>>> random.randint(0,10)
2
>>> random.randint(0,10)
5
>>> random.randint(0,10)
0
>>> random.randint(0,10)
7
>>> random.randint(0,10)
10
>>> random.randint(0,10)
3
>>>
```
ä¸ºäº†ç”Ÿæˆ0åˆ°1èŒƒå›´å†…å‡åŒ€åˆ†å¸ƒçš„æµ®ç‚¹æ•°ï¼Œä½¿ç”¨ `random.random()` ï¼š
```
>>> random.random()
0.9406677561675867
>>> random.random()
0.133129581343897
>>> random.random()
0.4144991136919316
>>>
```
å¦‚æœè¦è·å–Nä½éšæœºä½(äºŒè¿›åˆ¶)çš„æ•´æ•°ï¼Œä½¿ç”¨ random.getrandbits() ï¼š
```python
>>> random.getrandbits(200)
335837000776573622800628485064121869519521710558559406913275
>>>
```



### ğŸ struct æ¨¡å—

#### ğŸ¯ è¯»å†™äºŒè¿›åˆ¶æ•°ç»„æ•°æ®

è¯»å†™ä¸€ä¸ªäºŒè¿›åˆ¶æ•°ç»„çš„ç»“æ„åŒ–æ•°æ®åˆ°Pythonå…ƒç»„ä¸­ã€‚å¯ä»¥ä½¿ç”¨ struct æ¨¡å—å¤„ç†äºŒè¿›åˆ¶æ•°æ®ã€‚ ä¸‹é¢æ˜¯ä¸€æ®µç¤ºä¾‹ä»£ç å°†ä¸€ä¸ªPythonå…ƒç»„åˆ—è¡¨å†™å…¥ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ struct å°†æ¯ä¸ªå…ƒç»„ç¼–ç ä¸ºä¸€ä¸ªç»“æ„ä½“ã€‚
```python
from struct import Struct
def write_records(records, format, f):
    '''
    Write a sequence of tuples to a binary file of structures.
    '''
    record_struct = Struct(format)
    for r in records:
        f.write(record_struct.pack(*r))

# Example
if __name__ == '__main__':
    records = [ (1, 2.3, 4.5),
                (6, 7.8, 9.0),
                (12, 13.4, 56.7) ]
    with open('data.b', 'wb') as f:
        write_records(records, '<idd', f)
```
æœ‰å¾ˆå¤šç§æ–¹æ³•æ¥è¯»å–è¿™ä¸ªæ–‡ä»¶å¹¶è¿”å›ä¸€ä¸ªå…ƒç»„åˆ—è¡¨ã€‚ é¦–å…ˆï¼Œå¦‚æœæ‰“ç®—ä»¥å—çš„å½¢å¼å¢é‡è¯»å–æ–‡ä»¶ï¼Œå¯ä»¥è¿™æ ·åšï¼š
```python
from struct import Struct

def read_records(format, f):
    record_struct = Struct(format)
    chunks = iter(lambda: f.read(record_struct.size), b'')
    return (record_struct.unpack(chunk) for chunk in chunks)

# Example
if __name__ == '__main__':
    with open('data.b','rb') as f:
        for rec in read_records('<idd', f):
            # Process rec
            ...
```
å¦‚æœæƒ³å°†æ•´ä¸ªæ–‡ä»¶ä¸€æ¬¡æ€§è¯»å–åˆ°ä¸€ä¸ªå­—èŠ‚å­—ç¬¦ä¸²ä¸­ï¼Œç„¶ååœ¨åˆ†ç‰‡è§£æã€‚é‚£ä¹ˆå¯ä»¥è¿™æ ·åšï¼š
```python
from struct import Struct

def unpack_records(format, data):
    record_struct = Struct(format)
    return (record_struct.unpack_from(data, offset)
            for offset in range(0, len(data), record_struct.size))

# Example
if __name__ == '__main__':
    with open('data.b', 'rb') as f:
        data = f.read()
    for rec in unpack_records('<idd', data):
        # Process rec
        ...
```
ä¸¤ç§æƒ…å†µä¸‹çš„ç»“æœéƒ½æ˜¯ä¸€ä¸ªå¯è¿”å›ç”¨æ¥åˆ›å»ºè¯¥æ–‡ä»¶çš„åŸå§‹å…ƒç»„çš„å¯è¿­ä»£å¯¹è±¡ã€‚


#### ğŸ¯ è¯»å–åµŒå¥—å’Œå¯å˜é•¿äºŒè¿›åˆ¶æ•°æ®

éœ€è¦è¯»å–åŒ…å«åµŒå¥—æˆ–è€…å¯å˜é•¿è®°å½•é›†åˆçš„å¤æ‚äºŒè¿›åˆ¶æ ¼å¼çš„æ•°æ®ã€‚è¿™äº›æ•°æ®å¯èƒ½åŒ…å«å›¾ç‰‡ã€è§†é¢‘ã€ç”µå­åœ°å›¾æ–‡ä»¶ç­‰ã€‚

`struct` æ¨¡å—å¯è¢«ç”¨æ¥ç¼–ç /è§£ç å‡ ä¹æ‰€æœ‰ç±»å‹çš„äºŒè¿›åˆ¶çš„æ•°æ®ç»“æ„ã€‚ä¸ºäº†è§£é‡Šæ¸…æ¥šè¿™ç§æ•°æ®ï¼Œå‡è®¾ç”¨ä¸‹é¢çš„Pythonæ•°æ®ç»“æ„ æ¥è¡¨ç¤ºä¸€ä¸ªç»„æˆä¸€ç³»åˆ—å¤šè¾¹å½¢çš„ç‚¹çš„é›†åˆï¼š

```
polys = [
    [ (1.0, 2.5), (3.5, 4.0), (2.5, 1.5) ],
    [ (7.0, 1.2), (5.1, 3.0), (0.5, 7.5), (0.8, 9.0) ],
    [ (3.4, 6.3), (1.2, 0.5), (4.6, 9.2) ],
]
```

### ğŸ statistics æ¨¡å—

### ğŸ sys æ¨¡å—

#### ğŸ¯ å°†å­—èŠ‚å†™å…¥æ–‡æœ¬æ–‡ä»¶
å°†å­—èŠ‚æ•°æ®ç›´æ¥å†™å…¥æ–‡ä»¶çš„ç¼“å†²åŒºå³å¯ï¼Œä¾‹å¦‚ï¼š
```python
>>> import sys
>>> sys.stdout.write(b'Hello\n')
Traceback (most recent call last):
    File "<stdin>", line 1, in <module>
TypeError: must be str, not bytes
>>> sys.stdout.buffer.write(b'Hello\n')
Hello
5
>>>
```
ç±»ä¼¼çš„ï¼Œèƒ½å¤Ÿé€šè¿‡è¯»å–æ–‡æœ¬æ–‡ä»¶çš„ buffer å±æ€§æ¥è¯»å–äºŒè¿›åˆ¶æ•°æ®ã€‚

I/Oç³»ç»Ÿä»¥å±‚çº§ç»“æ„çš„å½¢å¼æ„å»ºè€Œæˆã€‚ æ–‡æœ¬æ–‡ä»¶æ˜¯é€šè¿‡åœ¨ä¸€ä¸ªæ‹¥æœ‰ç¼“å†²çš„äºŒè¿›åˆ¶æ¨¡å¼æ–‡ä»¶ä¸Šå¢åŠ ä¸€ä¸ªUnicodeç¼–ç /è§£ç å±‚æ¥åˆ›å»ºã€‚ buffer å±æ€§æŒ‡å‘å¯¹åº”çš„åº•å±‚æ–‡ä»¶ã€‚å¦‚æœç›´æ¥è®¿é—®å®ƒçš„è¯å°±ä¼šç»•è¿‡æ–‡æœ¬ç¼–ç /è§£ç å±‚ã€‚

### ğŸ tempfile æ¨¡å—
éœ€è¦åœ¨ç¨‹åºæ‰§è¡Œæ—¶åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¹¶å¸Œæœ›ä½¿ç”¨å®Œä¹‹åå¯ä»¥è‡ªåŠ¨é”€æ¯æ‰ã€‚

`tempfile` æ¨¡å—ä¸­æœ‰å¾ˆå¤šçš„å‡½æ•°å¯ä»¥å®Œæˆè¿™ä»»åŠ¡ã€‚ ä¸ºäº†åˆ›å»ºä¸€ä¸ªåŒ¿åçš„ä¸´æ—¶æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ `tempfile.TemporaryFile` ï¼š

```python
from tempfile import TemporaryFile

with TemporaryFile('w+t') as f:
    # Read/write to the file
    f.write('Hello World\n')
    f.write('Testing\n')

    # Seek back to beginning and read the data
    f.seek(0)
    data = f.read()

# Temporary file is destroyed
```

#### ğŸ¯ åˆ›å»ºä¸´æ—¶æ–‡ä»¶å’Œæ–‡ä»¶å¤¹

### ğŸ time æ¨¡å—
```python
import time

# å½“å‰æ—¶é—´æˆ³ï¼ˆç§’ï¼‰
ts = time.time()
print("å½“å‰æ—¶é—´æˆ³:", ts, type(ts))  
# è¾“å‡ºç¤ºä¾‹: 1681440000.123456 <class 'float'>

# æ—¶é—´æˆ³ -> æœ¬åœ°æ—¶é—´å…ƒç»„
local = time.localtime(ts)
print("æœ¬åœ°æ—¶é—´å…ƒç»„:", local, type(local))  
# time.struct_time(tm_year=..., ...) <class 'time.struct_time'>

# æ—¶é—´å…ƒç»„ -> å­—ç¬¦ä¸²
str_time = time.strftime("%Y-%m-%d %H:%M:%S", local)
print("æ ¼å¼åŒ–æ—¶é—´å­—ç¬¦ä¸²:", str_time, type(str_time))  
# '2025-04-10 15:30:45' <class 'str'>

# å­—ç¬¦ä¸² -> æ—¶é—´å…ƒç»„
parsed = time.strptime("2025-01-01 12:00:00", "%Y-%m-%d %H:%M:%S")
print("è§£æåçš„æ—¶é—´å…ƒç»„:", parsed, type(parsed))  
# time.struct_time(tm_year=2025, ...) <class 'time.struct_time'>

# æ—¶é—´å…ƒç»„ -> æ—¶é—´æˆ³
ts_from_struct = time.mktime(parsed)
print("ä»ç»“æ„ä½“å¾—åˆ°æ—¶é—´æˆ³:", ts_from_struct, type(ts_from_struct))  
# 1735723200.0 <class 'float'>
```


### ğŸ time å’Œ datetime å¯¹æ¯”

| åŠŸèƒ½         | `time` æ¨¡å—               | `datetime` æ¨¡å—          |
| ------------ | ------------------------- | ------------------------ |
| æ—¶é—´æˆ³æ“ä½œ   | âœ… `time.time()`           | âœ… `datetime.timestamp()` |
| å­—ç¬¦ä¸²æ ¼å¼åŒ– | âœ… `strftime` / `strptime` | âœ… åŒæ ·æ”¯æŒ               |
| æ—¶é—´å·®è®¡ç®—   | âŒï¼ˆéœ€æ‰‹åŠ¨è®¡ç®—ï¼‰           | âœ… `datetime - datetime`  |
| åŠ å‡æ—¶é—´     | âŒï¼ˆéœ€è¦å°è£…ï¼‰             | âœ… ä½¿ç”¨ `timedelta`       |
| å¯è¯»æ€§ & OOP | è¾ƒåº•å±‚                    | æ›´ç›´è§‚ã€æ›´å¼ºå¤§           |



### ğŸ weakref æ¨¡å—ï¼ˆå¾ªç¯å¼•ç”¨ï¼‰
çš„ç¨‹åºåˆ›å»ºäº†å¾ˆå¤šå¾ªç¯å¼•ç”¨æ•°æ®ç»“æ„(æ¯”å¦‚æ ‘ã€å›¾ã€è§‚å¯Ÿè€…æ¨¡å¼ç­‰)ï¼Œç¢°åˆ°äº†å†…å­˜ç®¡ç†éš¾é¢˜ã€‚

ä¸€ä¸ªç®€å•çš„å¾ªç¯å¼•ç”¨æ•°æ®ç»“æ„ä¾‹å­å°±æ˜¯ä¸€ä¸ªæ ‘å½¢ç»“æ„ï¼ŒåŒäº²èŠ‚ç‚¹æœ‰æŒ‡é’ˆæŒ‡å‘å­©å­èŠ‚ç‚¹ï¼Œå­©å­èŠ‚ç‚¹åˆè¿”å›æ¥æŒ‡å‘åŒäº²èŠ‚ç‚¹ã€‚ è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ `weakref` åº“ä¸­çš„å¼±å¼•ç”¨ã€‚ä¾‹å¦‚ï¼š
```python
import weakref

class Node:
    def __init__(self, value):
        self.value = value
        self._parent = None
        self.children = []

    def __repr__(self):
        return 'Node({!r:})'.format(self.value)

    # property that manages the parent as a weak-reference
    @property
    def parent(self):
        return None if self._parent is None else self._parent()

    @parent.setter
    def parent(self, node):
        self._parent = weakref.ref(node)

    def add_child(self, child):
        self.children.append(child)
        child.parent = self
```

è¿™ç§æ˜¯æƒ³æ–¹å¼å…è®¸parenté™é»˜ç»ˆæ­¢ã€‚ä¾‹å¦‚ï¼š
```python
>>> root = Node('parent')
>>> c1 = Node('child')
>>> root.add_child(c1)
>>> print(c1.parent)
Node('parent')
>>> del root
>>> print(c1.parent)
None
>>>
```

å¾ªç¯å¼•ç”¨çš„æ•°æ®ç»“æ„åœ¨Pythonä¸­æ˜¯ä¸€ä¸ªå¾ˆæ£˜æ‰‹çš„é—®é¢˜ï¼Œå› ä¸ºæ­£å¸¸çš„åƒåœ¾å›æ”¶æœºåˆ¶ä¸èƒ½é€‚ç”¨äºè¿™ç§æƒ…å½¢ã€‚ ä¾‹å¦‚è€ƒè™‘å¦‚ä¸‹ä»£ç ï¼š
```python
# Class just to illustrate when deletion occurs
class Data:
    def __del__(self):
        print('Data.__del__')

# Node class involving a cycle
class Node:
    def __init__(self):
        self.data = Data()
        self.parent = None
        self.children = []

    def add_child(self, child):
        self.children.append(child)
        child.parent = self


>>> a = Data()
>>> del a # Immediately deleted
Data.__del__
>>> a = Node()
>>> del a # Immediately deleted
Data.__del__
>>> a = Node()
>>> a.add_child(Node())
>>> del a # Not deleted (no message)
>>>
```
å¯ä»¥çœ‹åˆ°ï¼Œæœ€åä¸€ä¸ªçš„åˆ é™¤æ—¶æ‰“å°è¯­å¥æ²¡æœ‰å‡ºç°ã€‚åŸå› æ˜¯Pythonçš„åƒåœ¾å›æ”¶æœºåˆ¶æ˜¯åŸºäºç®€å•çš„å¼•ç”¨è®¡æ•°ã€‚ å½“ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨æ•°å˜æˆ0çš„æ—¶å€™æ‰ä¼šç«‹å³åˆ é™¤æ‰ã€‚è€Œå¯¹äºå¾ªç¯å¼•ç”¨è¿™ä¸ªæ¡ä»¶æ°¸è¿œä¸ä¼šæˆç«‹ã€‚ å› æ­¤ï¼Œåœ¨ä¸Šé¢ä¾‹å­ä¸­æœ€åéƒ¨åˆ†ï¼Œçˆ¶èŠ‚ç‚¹å’Œå­©å­èŠ‚ç‚¹äº’ç›¸æ‹¥æœ‰å¯¹æ–¹çš„å¼•ç”¨ï¼Œå¯¼è‡´æ¯ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°éƒ½ä¸å¯èƒ½å˜æˆ0ã€‚

å¼±å¼•ç”¨æ¶ˆé™¤äº†å¼•ç”¨å¾ªç¯çš„è¿™ä¸ªé—®é¢˜ï¼Œæœ¬è´¨æ¥è®²ï¼Œå¼±å¼•ç”¨å°±æ˜¯ä¸€ä¸ªå¯¹è±¡æŒ‡é’ˆï¼Œå®ƒä¸ä¼šå¢åŠ å®ƒçš„å¼•ç”¨è®¡æ•°ã€‚ å¯ä»¥é€šè¿‡ `weakref` æ¥åˆ›å»ºå¼±å¼•ç”¨ã€‚ä¾‹å¦‚ï¼š
```python
>>> import weakref
>>> a = Node()
>>> a_ref = weakref.ref(a)
>>> a_ref
<weakref at 0x100581f70; to 'Node' at 0x1005c5410>
>>>
```

ä¸ºäº†è®¿é—®å¼±å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡ï¼Œå¯ä»¥åƒå‡½æ•°ä¸€æ ·å»è°ƒç”¨å®ƒå³å¯ã€‚å¦‚æœé‚£ä¸ªå¯¹è±¡è¿˜å­˜åœ¨å°±ä¼šè¿”å›å®ƒï¼Œå¦åˆ™å°±è¿”å›ä¸€ä¸ªNoneã€‚ ç”±äºåŸå§‹å¯¹è±¡çš„å¼•ç”¨è®¡æ•°æ²¡æœ‰å¢åŠ ï¼Œé‚£ä¹ˆå°±å¯ä»¥å»åˆ é™¤å®ƒäº†ã€‚ä¾‹å¦‚;
```python
>>> print(a_ref())
<__main__.Node object at 0x1005c5410>
>>> del a
Data.__del__
>>> print(a_ref())
None
>>>
```









